import{c as Qe,bO as Vt,z as ro,bP as uo,r as s,w,k as O,I as K,m as E,O as h,n as A,H as c,U as Oe,ae as co,K as $t,af as At,az as vo,aX as oe,o as Dt,ai as _,V as Ft,N as me,v as u,P as _t,a7 as j,a6 as St,Q as R,R as Ht,aA as zt,l as Y,F as Gt,q as mo,aB as Pe,bQ as po,aZ as fo,x as je,t as Ye,S as Tt,s as te,aO as go,ah as Ke,bG as ho,W as Bt,_ as Wt,bC as yo,J as bo,aj as wo,u as ko,j as xo,M as Lt,Y as Et,L as Co,bR as Mo,bS as Ee,bT as v,bU as Vo,bV as I,ap as So,aT as To,bW as Lo,bX as Eo,bY as It,bZ as Io,b_ as Oo,b$ as Po,a0 as $o,y as Ao,D as Do,bg as Fo,G as Ot,a5 as qe,a_ as _o,a8 as Ho,ag as Ie,a4 as Pt,c0 as zo,ad as Ze,c1 as Go,c2 as Bo}from"./index-CnIiJ40F.js";const Wo={class:"flex items-center gap-2 mb-6"},No={class:"flex items-center gap-2 mb-6"},Uo={class:"flex items-center gap-2 mb-2"},Ro=Qe({__name:"GlobalOriginDialog",props:Vt({vehicle:{},initialLatitude:{},initialLongitude:{}},{modelValue:{type:Boolean,required:!0},modelModifiers:{}}),emits:Vt(["origin-set"],["update:modelValue"]),setup(ae,{emit:le}){const{openSnackbar:m}=ro(),M=uo(ae,"modelValue"),Q=le,V=ae,i=s(V.initialLatitude),d=s(V.initialLongitude),o=s(0),S=s(!1);w(()=>[V.initialLatitude,V.initialLongitude],([G,y])=>{i.value=G,d.value=y});const T=O(()=>i.value!==null&&i.value!==void 0&&i.value>=-90&&i.value<=90&&d.value!==null&&d.value!==void 0&&d.value>=-180&&d.value<=180&&o.value!==null&&o.value!==void 0),x=()=>{M.value=!1},X=()=>{if(!(!T.value||S.value)){if(V.vehicle===void 0||V.vehicle.dateLastHeartbeat()===void 0||V.vehicle.dateLastHeartbeat()>new Date(Date.now()-5e3)){m({message:"Cannot set global origin. Vehicle does not appear to be online.",variant:"error"});return}S.value=!0;try{V.vehicle.setGlobalOrigin([i.value,d.value],o.value),m({message:"Global origin set successfully.",variant:"success"}),Q("origin-set",i.value,d.value),x()}catch(G){m({message:`Failed to set global origin: ${G}`,variant:"error"})}finally{S.value=!1}}},H=O(()=>[{text:"Cancel",action:x,disabled:S.value},{text:S.value?"Saving...":"Save",disabled:!T.value||S.value,action:X,class:S.value?"opacity-70":""}]);return(G,y)=>(E(),K(co,{"show-dialog":M.value,title:"Set Global Origin",variant:"text-only","max-width":"500px",actions:H.value,"onUpdate:showDialog":y[3]||(y[3]=f=>M.value=f)},{content:h(()=>[y[7]||(y[7]=A("p",{class:"text-sm mb-8 -mt-6 text-gray-300"}," This feature allows you to set the GNSS coordinates of the vehicle's local origin (0,0,0). This is useful when using local position units (such as indoor positioning systems or DVLs) where you want to define a corresponding global position. ",-1)),A("div",Wo,[c(Oe,{modelValue:i.value,"onUpdate:modelValue":y[0]||(y[0]=f=>i.value=f),modelModifiers:{number:!0},label:"Latitude",type:"number",step:"0.000001",hint:"Latitude in degrees (-90 to 90)","persistent-hint":"",variant:"outlined",rules:[f=>f!=null||"Latitude is required",f=>f>=-90&&f<=90||"Latitude must be between -90 and 90"],class:"flex-1"},null,8,["modelValue","rules"]),y[4]||(y[4]=A("span",{class:"text-white text-lg font-medium mb-6 w-4"},"°",-1))]),A("div",No,[c(Oe,{modelValue:d.value,"onUpdate:modelValue":y[1]||(y[1]=f=>d.value=f),modelModifiers:{number:!0},label:"Longitude",type:"number",step:"0.000001",hint:"Longitude in degrees (-180 to 180)","persistent-hint":"",variant:"outlined",rules:[f=>f!=null||"Longitude is required",f=>f>=-180&&f<=180||"Longitude must be between -180 and 180"],class:"flex-1"},null,8,["modelValue","rules"]),y[5]||(y[5]=A("span",{class:"text-white text-lg font-medium mb-6 w-4"},"°",-1))]),A("div",Uo,[c(Oe,{modelValue:o.value,"onUpdate:modelValue":y[2]||(y[2]=f=>o.value=f),modelModifiers:{number:!0},label:"Altitude",type:"number",step:"0.1",hint:"Altitude in meters (MSL)","persistent-hint":"",variant:"outlined",rules:[f=>f!=null||"Altitude is required"],class:"flex-1"},null,8,["modelValue","rules"]),y[6]||(y[6]=A("span",{class:"text-white text-lg font-medium mb-6 w-4"},"m",-1))])]),_:1},8,["show-dialog","actions"]))}}),qo={class:"flex justify-end"},Zo={key:0,class:"fixed top-[80px] right-5"},jo={key:1,class:"flex w-full items-center"},Yo={class:"flex justify-between w-full py-1 px-2 pt-3"},Ko={class:"flex items-center"},Qo=Qe({__name:"MissionChecklist",props:{modelValue:{type:Boolean}},emits:["update:modelValue","confirmed","dismissed"],setup(ae,{emit:le}){const m=$t(),M=At(),Q=ae,V=le,i=vo("cockpit-pre-arm-checklist",[]),d=s({}),o=s(""),S=s(null),T=s(!1),x=O(()=>Q.modelValue),X=()=>{const k={};for(const l of i.value??[])k[l.id]=!1;d.value=k},H=O(()=>{if(!M.showChecklistBeforeArm)return!0;const k=i.value??[];return k.length>0&&k.every(l=>d.value[l.id]===!0)});w(()=>x.value,k=>{k?(X(),oe(()=>{var l,g;return(g=(l=S.value)==null?void 0:l.focus)==null?void 0:g.call(l)})):(d.value={},T.value=!1)}),w(()=>i.value,k=>{if(!x.value)return;const l={...d.value},g={};for(const L of k??[])g[L.id]=!0,L.id in l||(l[L.id]=!1);for(const L of Object.keys(l)){const N=Number(L);g[N]||delete l[N]}d.value=l},{deep:!0});const G=async()=>{var g,L;const k=o.value.trim();if(!k)return;const l={id:Date.now(),text:k};i.value.push(l),x.value&&(d.value[l.id]=!1),o.value="",await oe(),(L=(g=S.value)==null?void 0:g.focus)==null||L.call(g)},y=k=>{if(i.value=i.value.filter(l=>l.id!==k),k in d.value){const l={...d.value};delete l[k],d.value=l}},f=()=>{V("dismissed"),V("update:modelValue",!1)},pe=()=>{V("confirmed",!0),V("update:modelValue",!1)};return Dt(()=>{i.value.length===0&&(i.value=[{id:Date.now(),text:"Ensure the vehicle is safe to launch"}]),x.value&&X()}),w(()=>M.showChecklistBeforeArm,k=>{k||_({message:"Pre-arm checklist disabled. You can re-enable it in Settings → Mission → Enable pre-arm checklist.",variant:"info",duration:5e3})},{immediate:!0}),(k,l)=>(E(),K(Bt,{modelValue:x.value,"onUpdate:modelValue":l[4]||(l[4]=g=>x.value=g),"max-width":"600",scrollable:"",persistent:""},{default:h(()=>[c(Ft,{style:me(u(m).globalGlassMenuStyles),class:"rounded-lg"},{default:h(()=>[c(_t,{class:"text-center relative pt-3"},{default:h(()=>[l[6]||(l[6]=A("h6",{class:"ml-4"},"Warning! Your vehicle is about to be armed",-1)),c(j,{icon:"",variant:"text",color:"white",class:"absolute right-1 top-1","aria-label":"Close",onClick:f},{default:h(()=>[c(St,null,{default:h(()=>l[5]||(l[5]=[R("mdi-close")])),_:1,__:[5]})]),_:1})]),_:1,__:[6]}),c(Ht,{class:"mt-[-10px]"},{default:h(()=>[c(zt,{lines:"one",theme:"dark",class:"bg-transparent"},{default:h(()=>[(E(!0),Y(Gt,null,mo(u(i),g=>(E(),K(Pe,{key:g.id,theme:"dark"},po({prepend:h(()=>[c(Tt,{modelValue:d.value[g.id],"onUpdate:modelValue":L=>d.value[g.id]=L,class:"mt-0","hide-details":"",density:"compact",disabled:!u(M).showChecklistBeforeArm},null,8,["modelValue","onUpdate:modelValue","disabled"])]),default:h(()=>[c(fo,{class:je([{"line-through opacity-60":d.value[g.id]},{"opacity-50":!u(M).showChecklistBeforeArm}])},{default:h(()=>[R(Ye(g.text),1)]),_:2},1032,["class"])]),_:2},[T.value&&u(i).length>1?{name:"append",fn:h(()=>[c(j,{icon:"",variant:"text",disabled:!u(M).showChecklistBeforeArm,onClick:L=>y(g.id)},{default:h(()=>[c(St,null,{default:h(()=>l[7]||(l[7]=[R("mdi-close")])),_:1,__:[7]})]),_:2},1032,["disabled","onClick"])]),key:"0"}:void 0]),1024))),128))]),_:1}),A("div",qo,[T.value?(E(),Y("div",jo,[T.value?(E(),K(Oe,{key:0,ref_key:"newItemInput",ref:S,modelValue:o.value,"onUpdate:modelValue":l[1]||(l[1]=g=>o.value=g),disabled:!u(M).showChecklistBeforeArm,variant:"filled",density:"compact",placeholder:"Type an item and press Enter","hide-details":"",class:"ml-6 w-[80%]","append-inner-icon":"mdi-plus",onKeyup:go(G,["enter"]),"onClick:appendInner":G},null,8,["modelValue","disabled"])):te("",!0),c(j,{"prepend-icon":"mdi-check",disabled:!u(M).showChecklistBeforeArm,variant:"text",color:"white",size:"small",class:"elevation-1 bg-[#FFFFFF15] hover:bg-[#FFFFFF22] ml-10",onClick:l[2]||(l[2]=()=>{T.value=!1,G()})},{default:h(()=>l[9]||(l[9]=[R("Done")])),_:1,__:[9]},8,["disabled"])])):(E(),Y("div",Zo,[c(j,{"prepend-icon":"mdi-format-list-checks",disabled:!u(M).showChecklistBeforeArm,variant:"text",color:"white",size:"small",class:"elevation-1 bg-[#FFFFFF15] hover:bg-[#FFFFFF22]",onClick:l[0]||(l[0]=g=>T.value=!0)},{default:h(()=>l[8]||(l[8]=[R(" Edit Items ")])),_:1,__:[8]},8,["disabled"])]))])]),_:1}),c(Ke,{class:"flex center w-[80%]",inset:""}),c(ho,null,{default:h(()=>[A("div",Yo,[c(j,{variant:"text",onClick:f},{default:h(()=>l[10]||(l[10]=[R("Cancel")])),_:1,__:[10]}),A("div",Ko,[c(Tt,{"model-value":!u(M).showChecklistBeforeArm,class:"mt-0 scale-[0.8]","hide-details":"",density:"compact","onUpdate:modelValue":l[3]||(l[3]=g=>u(M).showChecklistBeforeArm=!g)},null,8,["model-value"]),l[11]||(l[11]=A("p",{class:"text-xs text-center ml-2"},"Don't show this checklist again",-1))]),c(j,{color:"#ffffff33",class:je({"opacity-30":!H.value}),variant:"flat",disabled:!H.value,onClick:pe},{default:h(()=>l[12]||(l[12]=[R("Go")])),_:1,__:[12]},8,["class","disabled"])])]),_:1})]),_:1},8,["style"])]),_:1},8,["modelValue"]))}}),Xo=Wt(Qo,[["__scopeId","data-v-b0b8e43a"]]),Jo=["id"],ea={key:0},ta=Qe({__name:"Map",props:{widget:{}},setup(ae){var Ct;yo(e=>({"25de57f0":ao.value}));const le=ae,m=bo(le).widget,M=$t(),{showDialog:Q,closeDialog:V}=wo(),i=ko(),d=At(),o=s(),S=s(d.defaultMapZoom),T=s(d.defaultMapCenter),x=s(),X=O(()=>`map-${m.value.hash}`),H=O(()=>$e.value||ie.value),G=s(!1),y=s([]),f=s(),pe=s(!1),k=s(!1),l=s(!1),g=s(!1),L=s(0),N=s(0),ye=s("");let be,we,ke;const ie=s(!1),Nt=()=>{be==null||be.click(),ie.value=!1},Ut=()=>{we==null||we.click(),ie.value=!1},Rt=()=>{ke==null||ke.click(),ie.value=!1};let Xe;const ne=s(null),Je=s(0),se=s([]),et=O(()=>i.currentMissionSeq??1),tt=O(()=>Math.max(0,(et.value??1)-1)),ot=e=>{e.touches.length>1&&(k.value=!0,W.value&&Te(),clearTimeout(Xe))},at=e=>{e.touches.length<=1&&(Xe=window.setTimeout(()=>k.value=!1,300))},re=s(null),B=s({});Lt.registerUsage(Et.latitude),Lt.registerUsage(Et.longitude),Co(()=>{Object.keys(m.value.options).length===0&&(m.value.options={showVehiclePath:!0,showCoordinateGrid:!1}),m.value.options.showCoordinateGrid===void 0&&(m.value.options.showCoordinateGrid=!1),m.value.options.showMissionControlPanel===void 0&&(m.value.options.showMissionControlPanel=!0),D.enableAutoUpdate()});const xe=Ee.tileLayerOffline("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:23,maxNativeZoom:19,attribution:"© OpenStreetMap"}),Ce=Ee.tileLayerOffline("https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",{maxZoom:23,maxNativeZoom:19,attribution:"© Esri World Imagery"}),Me=Ee.tileLayerOffline("https://tiles.openseamap.org/seamark/{z}/{x}/{y}.png",{maxZoom:18,attribution:"© OpenSeaMap contributors"}),lt=v.tileLayer.wms("https://geoserver.openseamap.org/geoserver/gwc/service/wms",{layers:"gebco2021:gebco_2021",format:"image/png",transparent:!0,version:"1.1.1",attribution:"© GEBCO, OpenSeaMap",tileSize:256,maxZoom:19}),qt={OpenStreetMap:xe,"Esri World Imagery":Ce},Zt={Seamarks:Me,"Marine Profile":lt},ue=s(),$e=xo(ue),it=v.control.zoom({position:"bottomright"}),nt=v.control.layers(qt,Zt),fe=s(void 0);w(H,()=>{o.value!==void 0&&(H.value?(o.value.addControl(it),o.value.addControl(nt),rt()):(o.value.removeControl(it),o.value.removeControl(nt),ut()))}),w($e,()=>{H.value=$e.value}),w(()=>m.value.options.showCoordinateGrid,e=>{o.value!==void 0&&(e?Ae():jt())}),w([S,T],()=>{m.value.options.showCoordinateGrid&&o.value&&Ae(),H.value&&o.value&&rt()});const Ae=()=>{if(o.value)try{fe.value=Vo(o.value,fe.value)}catch(e){console.error("Failed to create grid overlay:",e)}},jt=()=>{fe.value&&o.value&&(o.value.removeLayer(fe.value),fe.value=void 0)},st=v.control.scale({position:"bottomright",metric:!0,imperial:!1,maxWidth:100}),rt=()=>{o.value&&(ut(),st.addTo(o.value))},ut=()=>{if(o.value)try{o.value.removeControl(st)}catch{}};Dt(async()=>{var U,z;(U=ue.value)==null||U.addEventListener("touchstart",ot,{passive:!0}),(z=ue.value)==null||z.addEventListener("touchend",at,{passive:!0}),o.value=v.map(X.value,{layers:[xe,Ce,Me,lt],attributionControl:!1}).setView(T.value,S.value),o.value.removeControl(o.value.zoomControl),o.value.on("click",b=>{C.value=[b.latlng.lat,b.latlng.lng]}),o.value.on("moveend",()=>{if(o.value===void 0)return;let{lat:b,lng:$}=o.value.getCenter();b&&$&&(T.value=[b,$])});const e=De(Ce,"Esri",19),t=De(xe,"OSM",19),a=De(Me,"Seamarks",18);o.value&&(e.addTo(o.value),t.addTo(o.value),a.addTo(o.value));const r=b=>{var ee;const $=((ee=b.getContainer)==null?void 0:ee.call(b))??b._container;$&&($.classList.add("hidden-savetiles"),$.style.display="none")};r(e),r(t),r(a),await oe();const n=b=>{var ee;const $=((ee=b.getContainer)==null?void 0:ee.call(b))??b._container;return Array.from(($==null?void 0:$.querySelectorAll("a"))??[])},[p]=n(e),[P]=n(t),[Z]=n(a);be=p,we=P,ke=Z,Fe(Ce,"Esri"),Fe(xe,"OSM"),Fe(Me,"Seamarks"),o.value.on("dragstart",()=>{pe.value=!0}),o.value.on("dragend",()=>{setTimeout(()=>pe.value=!1,200)}),o.value.on("zoomend",()=>{var b;W.value=!1,o.value!==void 0&&(S.value=((b=o.value)==null?void 0:b.getZoom())??T.value)}),o.value.on("contextmenu",b=>{C.value=[b.latlng.lat,b.latlng.lng]}),D.enableAutoUpdate(),window.addEventListener("keydown",gt),F.value?D.goToTarget(I.VEHICLE):D.goToTarget(I.HOME),!i.isVehicleOnline&&d.vehicleMission.length&&Ne(d.vehicleMission),m.value.options.showCoordinateGrid&&Ae(),G.value=!0,await _e(),d.registerMapMissionActions({downloadMissionFromVehicle:Ue,clearMapDrawing:Ve})});const Yt=e=>(t,a)=>{Q({variant:"info",message:`Save ${t._tilesforSave.length} ${e} tiles for offline use?`,persistent:!1,maxWidth:"450px",actions:[{text:"Cancel",color:"white",action:V},{text:"Save tiles",color:"white",action:()=>{a(),V()}}]})},Kt=e=>(t,a)=>{Q({variant:"warning",message:`Remove all saved ${e} tiles for this layer?`,persistent:!1,maxWidth:"450px",actions:[{text:"Cancel",color:"white",action:V},{text:"Remove tiles",color:"white",action:()=>{a(),V(),_({message:`${e} offline tiles removed`,variant:"info",duration:3e3})}}]})},De=(e,t,a)=>Ee.savetiles(e,{saveWhatYouSee:!0,maxZoom:a,alwaysDownload:!1,position:"topright",parallel:20,confirm:Yt(t),confirmRemoval:Kt(t),saveText:`<i class="mdi mdi-download" title="Save ${t} tiles"></i>`,rmText:`<i class="mdi mdi-trash-can" title="Remove ${t} tiles"></i>`}),Fe=(e,t)=>{e.on("savestart",a=>{var r;L.value=0,N.value=((r=a==null?void 0:a._tilesforSave)==null?void 0:r.length)??0,ye.value=t,g.value=!0,_({message:`Saving ${N.value} ${t} tiles...`,variant:"info",duration:2e3})}),e.on("loadtileend",()=>{L.value+=1,N.value>0&&L.value>=N.value&&(_({message:`${t} offline tiles saved!`,variant:"success",duration:3e3}),g.value=!1,ye.value="",L.value=0,N.value=0)})},Qt={open:async e=>{if(!o.value||k.value||pe.value)return;e.preventDefault(),e.stopPropagation();const t=o.value.mouseEventToContainerPoint(e),a=o.value.containerPointToLatLng(t);C.value=[a.lat,a.lng],await We(e,null)},close:()=>Te()},Ve=()=>{var e;(e=o.value)==null||e.eachLayer(t=>{(t instanceof v.Marker||t instanceof v.Polyline&&t.options.color==="#358AC3")&&o.value.removeLayer(t)}),se.value.forEach(t=>t.remove()),se.value=[],y.value=[],Se.value=void 0,J.value=void 0,de.value=void 0,q.value=void 0},_e=async()=>{G.value&&(Ve(),i.isVehicleOnline?await Ue():d.vehicleMission.length&&Ne(d.vehicleMission))};w(()=>i.isVehicleOnline,()=>{_e()}),w(()=>d.vehicleMissionRevision,()=>{_e()}),So(()=>{var e,t;D.disableAutoUpdate(),window.removeEventListener("keydown",gt),o.value&&(o.value.off("contextmenu"),Object.values(B.value).forEach(a=>a.remove()),B.value={}),(e=ue.value)==null||e.removeEventListener("touchstart",ot),(t=ue.value)==null||t.removeEventListener("touchend",at),d.registerMapMissionActions({downloadMissionFromVehicle:async()=>Promise.resolve(),clearMapDrawing:async()=>Promise.resolve()})}),w(T,(e,t)=>{var a;e.toString()!==t.toString()&&((a=o.value)==null||a.panTo(e))}),w(o,(e,t)=>{o.value!==void 0&&(e==null?void 0:e.options)===void 0&&(o.value=t)}),w(S,(e,t)=>{var a;e!==t&&(W.value=!1,(a=o.value)==null||a.setZoom(S.value))}),w(le.widget,()=>{var e;(e=o.value)==null||e.invalidateSize()});const ce=s(void 0),D=new Mo(e=>ce.value=e,e=>T.value=e);D.setTrackableTarget(I.VEHICLE,()=>F.value),D.setTrackableTarget(I.HOME,()=>x.value);const F=O(()=>i.coordinates.latitude?[i.coordinates.latitude,i.coordinates.longitude]:void 0),He=O(()=>{var e;return i.attitude.yaw?To((e=i.attitude)==null?void 0:e.yaw):0}),ct=O(()=>{const e=i.lastHeartbeat;return e?`${Lo(e??0,{includeSeconds:!0})} ago`:"never"}),{history:Xt}=Eo(F);(Ct=navigator==null?void 0:navigator.geolocation)==null||Ct.watchPosition(e=>{x.value||(x.value=[e.coords.latitude,e.coords.longitude])},e=>console.error(`Failed to get position: (${e.code}) ${e.message}`),{enableHighAccuracy:!1,timeout:5e3,maximumAge:0});let dt=!0;w([x,o],async()=>{x.value===T.value||!o.value||!dt||(D.goToTarget(I.HOME),dt=!1)});const q=s();w(i.coordinates,()=>{if(!(!o.value||!F.value)){if(q.value===void 0){let e=Io;i.vehicleType===It.MAV_TYPE_SURFACE_BOAT?e=Oo:i.vehicleType===It.MAV_TYPE_SUBMARINE&&(e=Po);const t=v.divIcon({className:"vehicle-marker",html:`<img src="${e}" style="width: 64px; height: 64px;">`,iconSize:[64,64],iconAnchor:[32,32]});q.value=v.marker(F.value,{icon:t});const a=v.tooltip({content:"No data available",className:"waypoint-tooltip",offset:[40,0]});q.value.bindTooltip(a),o.value.addLayer(q.value)}q.value.setLatLng(F.value)}}),w(F,(e,t)=>{ce.value===I.VEHICLE||t!==void 0||D.follow(I.VEHICLE)}),w([F,He,ct,()=>i.isArmed],()=>{var t,a,r,n,p;if(q.value===void 0)return;(n=q.value.getTooltip())==null||n.setContent(`
    <p>Coordinates: ${(t=F.value)==null?void 0:t[0].toFixed(6)}, ${(a=F.value)==null?void 0:a[1].toFixed(6)}</p>
    <p>Velocity: ${((r=i.velocity.ground)==null?void 0:r.toFixed(2))??"N/A"} m/s</p>
    <p>Heading: ${He.value.toFixed(2)}°</p>
    <p>${i.isArmed?"Armed":"Disarmed"}</p>
    <p>Last seen: ${ct.value}</p>
  `);const e=(p=q.value.getElement())==null?void 0:p.querySelector("img");e&&(e.style.transform=`rotate(${He.value}deg)`)});const J=s();w(x,()=>{if(o.value===void 0)return;const e=x.value;if(e!==void 0)if(J.value)J.value.setLatLng(e);else{J.value=v.marker(e,{icon:v.divIcon({className:"marker-icon",iconSize:[24,24],iconAnchor:[12,12]}),draggable:!0});const t=v.tooltip({content:'<i class="mdi mdi-home-map-marker text-[18px] "></i>',permanent:!0,direction:"center",className:"waypoint-tooltip",opacity:1});J.value.bindTooltip(t),J.value.on("dragend",a=>{const n=a.target.getLatLng();Re([n.lat,n.lng])}),o.value.addLayer(J.value)}});const Se=s();w(y,e=>{o.value&&(Se.value||(Se.value=v.polyline([],{color:"#358AC3",className:"mission-path"}).addTo(o.value)),Se.value.setLatLngs(e.map(t=>t.coordinates)),se.value.forEach(t=>t.remove()),se.value=[],e.forEach((t,a)=>{var U;const r=v.marker(t.coordinates),n=a===tt.value,p=n?18:16,P=n?"marker-icon marker-icon-active":"marker-icon ";r.setIcon(v.divIcon({className:P,iconSize:[p,p],iconAnchor:[p/2,p/2]}));const Z=v.tooltip({content:a.toString(),permanent:!0,direction:"center",className:"waypoint-tooltip",opacity:1,interactive:!0});r.bindTooltip(Z),(U=o.value)==null||U.addLayer(r),se.value.push(r),r.on("contextmenu",async z=>{o.value&&(z.originalEvent&&(v.DomEvent.preventDefault(z.originalEvent),v.DomEvent.stopPropagation(z.originalEvent)),C.value=[z.latlng.lat,z.latlng.lng],await We(z.originalEvent,a+1))}),r.on("add",()=>{var b;const z=(b=r.getTooltip())==null?void 0:b.getElement();z&&v.DomEvent.on(z,"contextmenu",async $=>{if(!o.value)return;v.DomEvent.preventDefault($),v.DomEvent.stopPropagation($);const ee=$,Mt=r.getLatLng();C.value=[Mt.lat,Mt.lng],await We(ee,a+1)})})}))},{deep:!0}),w([i.currentMissionSeq,et],()=>{se.value.forEach((e,t)=>{const a=t===tt.value,r=a?18:16,n=a?"marker-icon marker-icon-active":"marker-icon ";e.setIcon(v.divIcon({className:n,iconSize:[r,r],iconAnchor:[r/2,r/2]}))})});const ze=s();w(Xt,e=>{if(o.value===void 0||e===void 0)return;ze.value===void 0&&(ze.value=v.polyline([],{color:"#ffff00"}).addTo(o.value));const t=e.filter(a=>a.snapshot!==void 0).map(a=>a.snapshot);ze.value.setLatLngs(t)});const W=s(!1),C=s(null),vt=s(),Ge=s(!1),mt=s(0),pt=s(0),Be=s(),ge=$o([{item:"Set home waypoint",action:()=>ve("set-home-waypoint"),icon:"mdi-home-map-marker"},{item:"Set Global Origin",action:()=>ve("set-global-origin"),icon:"mdi-crosshairs-question"},{item:"Place Point of Interest",action:()=>ve("place-poi"),icon:"mdi-map-marker-plus"},{item:"GoTo",action:()=>ve("goto"),icon:"mdi-crosshairs-gps"},{item:"Set default map position",action:()=>ve("set-default-map-position"),icon:"mdi-map-check"}]),ft=()=>{const e=ne.value!==null,t=ge[ge.length-1],a=!!t&&t._isSkipToWp===!0;e&&!a?ge.push({item:`Skip mission to this WP (#${ne.value-1})`,action:()=>ve("skip-to-wp"),icon:"mdi-skip-next-circle",_isSkipToWp:!0}):!e&&a?ge.pop():e&&a&&(t.item=`Skip mission to this WP (#${ne.value-1})`)},We=async(e,t)=>{var a,r,n;W.value&&(W.value=!1,await oe()),ne.value=t,ft(),Je.value++,W.value=!0,await oe(),(a=f.value)!=null&&a.openAt?f.value.openAt(e):(await oe(),(n=(r=f.value)==null?void 0:r.openAt)==null||n.call(r,e))},de=s(),Jt=async()=>{var e;if(!(!o.value||!C.value))try{await d.setDefaultMapPosition(C.value,S.value),_({message:"Default map position set",variant:"success"});const t=v.marker(C.value,{icon:v.divIcon({className:"marker-icon",iconSize:[24,24],iconAnchor:[12,12]})}).addTo(o.value),a=v.tooltip({content:'<i class="mdi mdi-map-check text-[18px] border-[1px] rounded-full px-[2px] py-[1px]"></i>',permanent:!0,direction:"center",className:"waypoint-tooltip",opacity:1});t.bindTooltip(a).openTooltip();const r=t.getElement(),n=(e=t.getTooltip())==null?void 0:e.getElement();[r,n].forEach(p=>{p&&(p.style.transition="opacity 1s",p.style.opacity="1")}),setTimeout(()=>{[r,n].forEach(p=>{p&&(p.style.opacity="0")}),setTimeout(()=>{var p;(p=o.value)==null||p.removeLayer(t)},1e3)},1500)}catch(t){console.error(t),_({message:"Failed to set default map position",variant:"error"})}},eo=async()=>{if(!C.value||!o.value)return;de.value&&(o.value.removeLayer(de.value),de.value=void 0),de.value=v.marker(C.value,{icon:v.divIcon({className:"marker-icon",iconSize:[24,24],iconAnchor:[12,12]})}).addTo(o.value);const e=v.tooltip({content:'<i class="mdi mdi-crosshairs-gps border-[1px] rounded-full text-[18px] px-[2px] pt-[1px] "></i>',permanent:!0,direction:"center",className:"waypoint-tooltip",opacity:1});if(de.value.bindTooltip(e),C.value){const p=i.coordinates.altitude??0,P=C.value[0],Z=C.value[1];try{await i.goTo(0,0,0,0,P,Z,p)}catch(U){_({message:`GoTo request failed: ${U.message}`,variant:"error"})}}},ve=async e=>{switch(e){case"goto":{eo();break}case"set-default-map-position":Jt();break;case"place-poi":C.value&&re.value?re.value.openDialog(C.value):C.value?re.value||(_({message:"POI Manager (map widget) is not available.",variant:"error"}),console.error("Cannot open POI dialog, POI Manager (map widget) ref is not set.")):(_({message:"Cannot place Point of Interest without map coordinates.",variant:"error"}),console.error("Cannot open POI dialog without click coordinates for new POI"));break;case"set-home-waypoint":C.value&&Re(C.value);break;case"set-global-origin":C.value&&(mt.value=C.value[0],pt.value=C.value[1],Ge.value=!0);break;case"skip-to-wp":{const t=ne.value;if(!i.isVehicleOnline||t==null){_({message:"Cannot skip (vehicle offline or invalid WP).",variant:"error"});break}try{i.setMissionCurrent(t)}catch(a){_({message:`Failed to skip to WP #${t}: ${a.message}`,variant:"error"})}break}default:console.warn("Unknown menu option selected:",e)}W.value=!1},Te=()=>{W.value=!1,ne.value=null,ft(),o.value!==void 0&&vt.value!==void 0&&o.value.removeLayer(vt.value)},to=(e,t)=>{if(!o.value)return;Be.value&&o.value.removeLayer(Be.value);const a=v.divIcon({className:"marker-icon",iconSize:[24,24],iconAnchor:[12,12]}),r=v.marker([e,t],{icon:a}).addTo(o.value),n=v.tooltip({content:'<i class="mdi mdi-axis-arrow text-[18px]"></i>',permanent:!0,direction:"center",className:"waypoint-tooltip",opacity:1});r.bindTooltip(n),Be.value=r},gt=e=>{if(e.key==="Escape"){Te();return}},Ne=e=>{e.forEach((t,a)=>{a===0?(x.value=t.coordinates,Re(t.coordinates)):y.value.push(t)})},Le=s(!1),ht=s(0),Ue=async()=>{Le.value=!0,Ve();const e=async t=>{ht.value=t};try{const t=await i.fetchMission(e);Ne(t),_({variant:"success",message:"Mission download succeeded!",duration:3e3})}catch(t){Q({variant:"error",title:"Mission download failed",message:t,timer:5e3})}finally{Le.value=!1}},Re=async e=>{const t=[e[0],e[1]];x.value=t,await i.setHomeWaypoint(t,0),W.value&&(W.value=!1)},yt=async()=>{try{await i.startMission()}catch{_({message:"Failed to start mission.",variant:"error"})}},oo=async()=>{if(d.showChecklistBeforeArm){l.value=!0;return}yt()},he=Ao(),ao=O(()=>`${Math.max(-he.widgetClearanceForVisibleArea(m.value).bottom,0)}px`),bt=O(()=>`${Math.max(-he.widgetClearanceForVisibleArea(m.value).top,0)}px`),lo=O(()=>x.value===void 0?"Cannot center map on home (home position undefined).":ce.value===I.HOME?"Tracking home position. Click to stop tracking.":"Click once to center on home or twice to track it."),io=O(()=>i.isVehicleOnline?F.value===void 0?"Cannot center map on vehicle (vehicle position undefined).":ce.value===I.VEHICLE?"Tracking vehicle position. Click to stop tracking.":"Click once to center on vehicle or twice to track it.":"Cannot center map on vehicle (vehicle offline)."),wt=e=>({html:`
    <div class="poi-marker-container">
      <div class="poi-marker-background" style="background-color: ${e.color}80;"></div>
      <i class="v-icon notranslate mdi ${e.icon}" style="color: rgba(255, 255, 255, 0.7); position: relative; z-index: 2;"></i>
    </div>
  `,className:"poi-marker-icon-widget",iconSize:[32,32],iconAnchor:[16,32]}),kt=e=>{if(!o.value||!o.value.getContainer())return;const t=v.divIcon(wt(e)),a=v.marker(e.coordinates,{icon:t,draggable:!0}).addTo(o.value),r=`
    <strong>${e.name}</strong><br>
    ${e.description?e.description+"<br>":""}
    Lat: ${e.coordinates[0].toFixed(8)}, Lng: ${e.coordinates[1].toFixed(8)}
  `,n={permanent:!1,direction:"top",offset:[0,-40],className:"poi-tooltip-widget"};a.bindTooltip(r,n),a.on("drag",p=>{var U;const P=p.target.getLatLng(),Z=`
      <strong>${e.name}</strong><br>
      ${e.description?e.description+"<br>":""}
      Lat: ${P.lat.toFixed(8)}, Lng: ${P.lng.toFixed(8)}
    `;(U=a.getTooltip())==null||U.setContent(Z)}),a.on("dragend",p=>{const P=p.target.getLatLng();d.movePointOfInterest(e.id,[P.lat,P.lng])}),a.on("click",p=>{if(v.DomEvent.stopPropagation(p),re.value){const P=d.pointsOfInterest.find(Z=>Z.id===e.id);P?re.value.openDialog(void 0,P):console.warn("POI not found in store:",e.id)}}),B.value[e.id]=a},xt=e=>{var r;if(!o.value||!o.value.getContainer()||!B.value[e.id])return;const t=B.value[e.id];t.setLatLng(e.coordinates),t.setIcon(v.divIcon(wt(e)));const a=`
    <strong>${e.name}</strong><br>
    ${e.description?e.description+"<br>":""}
    Lat: ${e.coordinates[0].toFixed(8)}, Lng: ${e.coordinates[1].toFixed(8)}
  `;(r=t.getTooltip())==null||r.setContent(a)},no=e=>{!o.value||!B.value[e]||(B.value[e].remove(),delete B.value[e])},so=()=>{m.value.options.showMissionControlPanel=!1};return w(()=>d.pointsOfInterest,async e=>{if((!o.value||!o.value.getContainer())&&(await oe(),!o.value||!o.value.getContainer())){console.warn("Map.vue: POI watcher - map not ready after nextTick.");return}const t=new Set(e.map(a=>a.id));Object.keys(B.value).forEach(a=>{t.has(a)||no(a)}),e.forEach(a=>{B.value[a.id]?xt(a):kt(a)})},{deep:!0,immediate:!0}),w(o,e=>{e&&e.getContainer()&&d.pointsOfInterest.forEach(t=>{B.value[t.id]?xt(t):kt(t)})},{immediate:!0}),(e,t)=>{const a=Do("MissionControlPanel"),r=Fo("contextmenu");return E(),Y(Gt,null,[Ot((E(),Y("div",{ref_key:"mapBase",ref:ue,class:je(["page-base",u(he).editingMode?"pointer-events-none":"pointer-events-auto"])},[A("div",{id:X.value,ref_key:"map",ref:o,class:"map"},[c(Ho,{modelValue:ie.value,"onUpdate:modelValue":t[0]||(t[0]=n=>ie.value=n),"close-on-content-click":!1,location:"top end"},{activator:h(({props:n})=>[Ot(c(j,qe(n,{class:"absolute right-[137px] m-3 bottom-button bg-slate-50 text-[14px]",elevation:"2",size:"x-small",style:{"z-index":"1002","border-radius":"0px"},icon:"mdi-download-multiple"}),null,16),[[_o,H.value]])]),default:h(()=>[c(zt,{style:me(u(M).globalGlassMenuStyles),class:"py-0 min-w-[220px] rounded-lg border-[1px]"},{default:h(()=>[c(Pe,{class:"py-0",title:"Save visible Esri tiles",onClick:Nt}),c(Ke),c(Pe,{class:"py-0",title:"Save visible OSM tiles",onClick:Ut}),c(Ke),c(Pe,{class:"py-0",title:"Save visible Seamarks tiles",onClick:Rt})]),_:1},8,["style"])]),_:1},8,["modelValue"]),c(Pt,{location:"top",text:lo.value},{activator:h(({props:n})=>[H.value?(E(),K(j,qe({key:0},n,{class:["absolute right-[90px] m-3 bottom-button bg-slate-50 text-[14px]",x.value?"":"active-events-on-disabled"],color:ce.value==u(I).HOME?"red":"",elevation:"2",style:{"z-index":"1002","border-radius":"0px"},icon:"mdi-home-search",size:"x-small",disabled:!x.value,onClick:t[1]||(t[1]=Ie(p=>u(D).goToTarget(u(I).HOME,!0),["stop"])),onDblclick:t[2]||(t[2]=Ie(p=>u(D).follow(u(I).HOME),["stop"]))}),null,16,["class","color","disabled"])):te("",!0)]),_:1},8,["text"]),c(Pt,{location:"top",text:io.value},{activator:h(({props:n})=>[H.value?(E(),K(j,qe({key:0},n,{class:["absolute m-3 bottom-button right-[44px] bg-slate-50 text-[14px]",F.value?"":"active-events-on-disabled"],color:ce.value==u(I).VEHICLE?"red":"",elevation:"2",style:{"z-index":"1002","border-radius":"0px"},icon:"mdi-airplane-marker",size:"x-small",disabled:!F.value,onClick:t[3]||(t[3]=Ie(p=>u(D).goToTarget(u(I).VEHICLE,!0),["stop"])),onDblclick:t[4]||(t[4]=Ie(p=>u(D).follow(u(I).VEHICLE),["stop"]))}),null,16,["class","color","disabled"])):te("",!0)]),_:1},8,["text"])],8,Jo)],2)),[[r,Qt]]),(E(),K(zo,{ref_key:"contextMenuRef",ref:f,key:Je.value,visible:W.value,width:"260px","menu-items":ge,onClose:Te},null,8,["visible","menu-items"])),c(Bt,{modelValue:u(he).widgetManagerVars(u(m).hash).configMenuOpen,"onUpdate:modelValue":t[8]||(t[8]=n=>u(he).widgetManagerVars(u(m).hash).configMenuOpen=n),width:"auto"},{default:h(()=>[c(Ft,{class:"pa-2",style:me(u(M).globalGlassMenuStyles)},{default:h(()=>[c(_t,{class:"text-center"},{default:h(()=>t[12]||(t[12]=[R("Map widget settings")])),_:1,__:[12]}),c(Ht,null,{default:h(()=>[c(Ze,{modelValue:u(m).options.showVehiclePath,"onUpdate:modelValue":t[5]||(t[5]=n=>u(m).options.showVehiclePath=n),class:"my-1",label:"Show vehicle path",color:u(m).options.showVehiclePath?"white":void 0,"hide-details":""},null,8,["modelValue","color"]),c(Ze,{modelValue:u(m).options.showCoordinateGrid,"onUpdate:modelValue":t[6]||(t[6]=n=>u(m).options.showCoordinateGrid=n),class:"my-1",label:"Show coordinate grid",color:u(m).options.showCoordinateGrid?"white":void 0,"hide-details":""},null,8,["modelValue","color"]),c(Ze,{modelValue:u(m).options.showMissionControlPanel,"onUpdate:modelValue":t[7]||(t[7]=n=>u(m).options.showMissionControlPanel=n),class:"my-1",label:"Show mission control panel",color:u(m).options.showMissionControlPanel?"white":void 0,"hide-details":""},null,8,["modelValue","color"])]),_:1})]),_:1},8,["style"])]),_:1},8,["modelValue"]),Le.value?(E(),K(Go,{key:0,"model-value":ht.value,height:"10",absolute:"",bottom:"",color:"white",style:me(`top: ${bt.value}`)},null,8,["model-value","style"])):te("",!0),Le.value?(E(),Y("p",{key:1,style:me({top:bt.value}),class:"absolute left-[7px] mt-4 flex text-md font-bold text-white z-30 drop-shadow-md"}," Loading mission... ",4)):te("",!0),c(Bo,{ref_key:"poiManagerMapWidgetRef",ref:re},null,512),c(Xo,{"model-value":l.value,onConfirmed:yt,"onUpdate:modelValue":t[9]||(t[9]=n=>l.value=n)},null,8,["model-value"]),c(Ro,{modelValue:Ge.value,"onUpdate:modelValue":t[10]||(t[10]=n=>Ge.value=n),vehicle:u(i).mainVehicle,"initial-latitude":mt.value,"initial-longitude":pt.value,onOriginSet:to},null,8,["modelValue","vehicle","initial-latitude","initial-longitude"]),c(a,{modelValue:u(m).options.showMissionControlPanel,"onUpdate:modelValue":t[11]||(t[11]=n=>u(m).options.showMissionControlPanel=n),"map-waypoints":y.value,onDownloadMissionFromVehicle:Ue,onClearMapDrawing:Ve,onTryToStartMission:oo,onHideControlPanel:so},null,8,["modelValue","map-waypoints"]),g.value?(E(),Y("div",{key:2,class:"absolute top-14 left-2 flex justify-start items-center text-white text-md py-2 px-4 rounded-lg",style:me(u(M).globalGlassMenuStyles)},[A("p",null,[t[13]||(t[13]=R(" Saving offline map content ")),ye.value?(E(),Y("span",ea,"("+Ye(ye.value)+")",1)):te("",!0),R(":  "+Ye(N.value?Math.round(L.value/N.value*100):0)+"% ",1)])],4)):te("",!0)],64)}}}),aa=Wt(ta,[["__scopeId","data-v-567e5b9d"]]);export{aa as default};
