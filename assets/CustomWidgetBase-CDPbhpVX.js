import{c as we,z as he,K as be,aL as xe,J as ye,r as v,k as B,aB as ke,w as Ve,L as Me,o as Ce,l as d,m,n as u,H as o,N as r,Q as V,ae as q,q as D,ar as Q,aM as We,O,t as Y,s as a,v as M,I as j,a5 as R,a2 as Fe,aN as Be,aO as T,aP as H,aQ as Se,aR as Le,x as p,F as S,p as z,aS as Z,aT as ee,V as Oe,P as ze,U as te,az as ae,aU as Ee,al as Ie,aH as Ne,aV as Ue,aW as $e,_ as Ae}from"./index-nbO6CBjw.js";const De=["width","height"],je={class:"flex flex-col justify-between h-full pa-2 cursor-pointer"},Re={class:"flex justify-between w-full"},Te={key:0},He={key:0},_e={class:"flex"},Xe={key:0,class:"flex rotate-[270deg] justify-center whitespace-nowrap"},Ge={class:"flex justify-center h-full px-3 pt-2 gap-x-2"},Ke=["data-widget-hash"],Je=["data-widget-hash"],Pe={class:"flex flex-col justify-start items-start gap-x-4 mt-3 w-full"},qe=we({__name:"CustomWidgetBase",props:{widget:{}},setup(se){const i=he(),le=be(),{showSnackbar:E}=xe(),w=se,n=ye(w).widget,c=v(w.widget),I=v(new Map),_=v(!1),X=v("justify-center"),ne=v(!1),N=v(!1),C=v(w.widget.name),x=v(null),L=v(w.widget.options.leftColumnWidth||50),G=v(!1),W=v(null),f=v(!1),y=v("right"),U=()=>{if(W.value){const s=W.value.getBoundingClientRect(),e=window.innerWidth;s.left+s.width/2<e/2?y.value="left":y.value="right"}},oe=B(()=>y.value==="left"?f.value?"mdi-chevron-right":"mdi-chevron-left":f.value?"mdi-chevron-left":"mdi-chevron-right"),ie=()=>{C.value=w.widget.name,N.value=!0,Ne(()=>{x.value&&(x.value.focus(),x.value.select())})},K=()=>{N.value=!1,c.value&&C.value!==c.value.name&&(c.value.name=C.value)},de=s=>{var l;const e=(l=s.target.files)==null?void 0:l[0];if(!e){E({variant:"error",message:"No file selected.",duration:3e3});return}const t=new FileReader;t.onload=k=>{var b;try{const g=JSON.parse((b=k.target)==null?void 0:b.result),F=c.value.hash;i.loadWidgetFromFile(F,g)}catch{E({variant:"error",message:"Invalid widget file format.",duration:3e3})}},t.readAsText(e)},$=s=>{if(ne.value=!1,s==="options")i.widgetManagerVars(c.value.hash).configMenuOpen=!0;else if(s==="save")re();else if(s==="load"){const e=document.createElement("input");e.type="file",e.accept=".widget",e.addEventListener("change",t=>{de(t)}),e.click()}},re=()=>{const s=new Blob([JSON.stringify(n.value)],{type:"application/json;charset=utf-8"}),e=`${n.value.name}.widget`;Ue(s,e)},ue=s=>{if(!i.editingMode)return;const e=s.clientX,t=L.value;G.value=!0;const l=b=>{if(!W.value)return;const g=W.value.offsetWidth,F=t+(b.clientX-e)/g*100;L.value=Math.max(10,Math.min(90,F))},k=()=>{G.value=!1,document.removeEventListener("mousemove",l),document.removeEventListener("mouseup",k)};document.addEventListener("mousemove",l),document.addEventListener("mouseup",k)},me=B(()=>c.value.options.elementContainers.filter(s=>s.name.includes("left"))),ge=B(()=>c.value.options.elementContainers.filter(s=>s.name.includes("right"))),ve=B(()=>Math.round(n.value.options.backgroundOpacity*255).toString(16)),ce=()=>{i.allowMovingAndResizing(c.value.hash,!0),window.addEventListener("mouseup",h),window.addEventListener("dragend",h)},h=()=>{U(),i.allowMovingAndResizing(c.value.hash,!1),window.removeEventListener("mouseup",h),window.removeEventListener("dragend",h)},J=(s,e)=>{const t=c.value.options.elementContainers.find(g=>g.name===e);if(!t)return;const l=t.elements.map(g=>g.hash),k=I.value.get(e)||[],b=l.find(g=>!k.includes(g));if(b){const g=t.elements.find(F=>F.hash===b);g&&s.pullMode==="clone"&&(g.hash=$e(),i.miniWidgetManagerVars(g.hash).configMenuOpen=!0),I.value.set(e,l)}},{width:P}=ke(),A=B(()=>({width:c.value.size.width*P.value,height:c.value.size.height*P.value})),fe=v(null);Ve(()=>i.editingMode,s=>{s===!0&&(h(),f.value=!1)});const pe=()=>{try{const s=i.editWidgetByHash(w.widget.hash);s&&(c.value=s)}catch{E({variant:"warning",message:"Error reading widget file.",duration:1e3})}};return Me(()=>{w.widget.options.elementContainers.forEach(s=>{I.value.set(s.name,s.elements.map(e=>e.hash))})}),Ce(()=>{U(),window.addEventListener("resize",U),fe.value=document.querySelector(".main"),pe(),h()}),(s,e)=>(d(),m(S,null,[u("div",{ref_key:"widgetBase",ref:W,class:p(["h-full rounded-lg overflow-hidden",[f.value?"w-[40px]":"w-full",f.value&&y.value==="left"?"ml-0 mr-auto":"",f.value&&y.value==="right"?"mr-0 ml-auto":""]]),width:A.value.width,height:A.value.height,style:O([a(le).globalGlassMenuStyles,{backgroundColor:`${a(n).options.backgroundColor+ve.value}`,backdropFilter:`blur(${a(n).options.backgroundBlur}px)`}])},[u("div",je,[u("div",Re,[o(q,{class:"cursor-grab opacity-40",onMousedown:ce,onMouseup:h},{default:r(()=>e[11]||(e[11]=[V(" mdi-drag ")])),_:1}),f.value?M("",!0):(d(),m("div",Te,[N.value?(d(),m("div",He,[D(u("input",{ref_key:"nameInput",ref:x,"onUpdate:modelValue":e[0]||(e[0]=t=>C.value=t),class:"border-b border-gray-400",onBlur:K,onKeyup:We(K,["enter"])},null,544),[[Q,C.value]])])):(d(),m("p",{key:1,class:"whitespace-nowrap overflow-hidden text-ellipsis",style:O({maxWidth:`${A.value.width*.8}px`}),onDblclick:ie},Y(a(n).name),37))])),u("div",_e,[a(i).editingMode?(d(),j(Se,{key:0,theme:"dark"},{activator:r(({props:t})=>[o(R,Fe({size:"20",icon:"mdi-dots-vertical",variant:"text"},t),null,16)]),default:r(()=>[o(Be,null,{default:r(()=>[o(T,{onClick:e[1]||(e[1]=t=>$("options"))},{default:r(()=>[o(H,null,{default:r(()=>e[12]||(e[12]=[V("Options")])),_:1})]),_:1}),o(T,{onClick:e[2]||(e[2]=t=>$("save"))},{default:r(()=>[o(H,null,{default:r(()=>e[13]||(e[13]=[V("Save")])),_:1})]),_:1}),o(T,{onClick:e[3]||(e[3]=t=>$("load"))},{default:r(()=>[o(H,null,{default:r(()=>e[14]||(e[14]=[V("Load")])),_:1})]),_:1})]),_:1})]),_:1})):M("",!0)])]),f.value?(d(),m("div",Xe,Y(a(n).name),1)):M("",!0),D(u("div",Ge,[u("div",{class:p(["flex flex-col justify-center border-[#FFFFFF33] border-dashed rounded-md",[a(i).editingMode?"border-[1px]":"border-0"]]),style:O({width:a(n).options.columns>1?`${L.value}%`:"100%"})},[(d(!0),m(S,null,z(me.value,t=>(d(),m("div",{key:t.name,class:"w-full h-full"},[o(a(ee),{modelValue:t.elements,"onUpdate:modelValue":l=>t.elements=l,disabled:!a(i).editingMode,animation:150,group:"generalGroup",class:p(["flex items-center w-full h-full gap-2 px-2",[_.value?"flex-wrap":"",X.value]]),onAdd:l=>J(l,t.name)},{default:r(()=>[(d(!0),m(S,null,z(t.elements,l=>(d(),m("div",{key:l.hash,"data-widget-hash":l.hash,class:p(["rounded-md w-full",{"cursor-grab":a(i).editingMode,"bg-slate-400":a(i).miniWidgetManagerVars(l.hash).highlighted}])},[o(Z,{"mini-widget":l},null,8,["mini-widget"])],10,Ke))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","disabled","class","onAdd"])]))),128))],6),a(n).options.columns>1&&a(i).editingMode?(d(),m("div",{key:0,class:"cursor-col-resize w-1 bg-[#FFFFFF22] relative",onMousedown:ue},e[15]||(e[15]=[u("div",{class:"absolute inset-y-0 -left-1 -right-1"},null,-1)]),32)):M("",!0),a(n).options.columns>1?(d(),m("div",{key:1,class:p(["flex flex-col justify-center border-[#FFFFFF33] border-dashed rounded-md",[a(i).editingMode?"border-[1px]":"border-0"]]),style:O({width:`${100-L.value}%`})},[(d(!0),m(S,null,z(ge.value,t=>(d(),m("div",{key:t.name,class:"w-full h-full"},[o(a(ee),{modelValue:t.elements,"onUpdate:modelValue":l=>t.elements=l,disabled:!a(i).editingMode,animation:150,group:"generalGroup",class:p(["flex items-center w-full h-full gap-2 px-2",[_.value?"flex-wrap":"",X.value]]),onAdd:l=>J(l,t.name)},{default:r(()=>[(d(!0),m(S,null,z(t.elements,l=>(d(),m("div",{key:l.hash,"data-widget-hash":l.hash,class:p(["rounded-md w-full",{"cursor-grab":a(i).editingMode,"bg-slate-400":a(i).miniWidgetManagerVars(l.hash).highlighted}])},[o(Z,{"mini-widget":l},null,8,["mini-widget"])],10,Je))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","disabled","class","onAdd"])]))),128))],6)):M("",!0)],512),[[Le,!f.value]]),e[16]||(e[16]=u("div",null,null,-1)),a(i).editingMode?M("",!0):(d(),j(R,{key:1,class:p(["fixed bottom-[2px]",y.value==="left"?"left-[2px]":"right-[2px]"]),icon:oe.value,variant:"text",size:"36",onClick:e[4]||(e[4]=t=>f.value=!f.value)},null,8,["class","icon"]))])],14,De),(d(),j(Ie,{to:"body"},[o(Ee,{"is-visible":a(i).widgetManagerVars(a(n).hash).configMenuOpen},{default:r(()=>[o(Oe,{class:"px-8 pb-6 pt-2 rounded-lg w-[400px] bg-transparent"},{default:r(()=>[o(ze,{class:"text-center -mt-1"},{default:r(()=>e[17]||(e[17]=[V("Custom Widget options")])),_:1}),o(R,{class:"absolute top-3 right-0 text-lg rounded-full",variant:"text",size:"small",onClick:e[5]||(e[5]=t=>a(i).widgetManagerVars(a(n).hash).configMenuOpen=!1)},{default:r(()=>[o(q,null,{default:r(()=>e[18]||(e[18]=[V("mdi-close")])),_:1})]),_:1}),u("div",Pe,[e[19]||(e[19]=u("p",{class:"text-start"},"Name:",-1)),o(te,{ref_key:"nameInput",ref:x,modelValue:a(n).name,"onUpdate:modelValue":e[6]||(e[6]=t=>a(n).name=t),density:"compact",class:"w-3/4"},null,8,["modelValue"]),e[20]||(e[20]=u("p",{class:"text-start"},"Columns:",-1)),o(te,{ref_key:"nameInput",ref:x,modelValue:a(n).options.columns,"onUpdate:modelValue":e[7]||(e[7]=t=>a(n).options.columns=t),min:"1",max:"2",type:"number",density:"compact",class:"w-1/4"},null,8,["modelValue"]),e[21]||(e[21]=u("p",{class:"mt-1"},"Background color",-1)),D(u("input",{"onUpdate:modelValue":e[8]||(e[8]=t=>a(n).options.backgroundColor=t),type:"color",class:"p-0 w-20 mr-4"},null,512),[[Q,a(n).options.backgroundColor]]),e[22]||(e[22]=u("p",{class:"mt-3"},"Background opacity:",-1)),o(ae,{modelValue:a(n).options.backgroundOpacity,"onUpdate:modelValue":e[9]||(e[9]=t=>a(n).options.backgroundOpacity=t),min:"0",max:"1",color:"white","thumb-label":"",width:"250"},null,8,["modelValue"]),e[23]||(e[23]=u("p",{class:"mt-3"},"Background blur:",-1)),o(ae,{modelValue:a(n).options.backgroundBlur,"onUpdate:modelValue":e[10]||(e[10]=t=>a(n).options.backgroundBlur=t),min:"0",max:"100",color:"white","thumb-label":"",width:"250"},null,8,["modelValue"])])]),_:1})]),_:1},8,["is-visible"])]))],64))}}),Ye=Ae(qe,[["__scopeId","data-v-177c0ca3"]]);export{Ye as default};
