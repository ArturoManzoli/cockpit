import{c as We,K as Ze,aR as Ge,aY as ft,r as c,k as E,w as g,bm as ye,o as je,aZ as B,I as z,m as w,N as v,H as u,V as Ye,O as ue,v as s,P as Ke,n as K,ai as _,ag as De,Q as D,R as qe,a_ as gt,l as q,F as Je,q as ht,a$ as yt,bY as bt,bo as kt,x as be,t as xt,S as ze,s as R,U as wt,bd as Ct,aN as Mt,bR as Tt,W as Qe,_ as Xe,bO as Vt,J as Et,aG as It,u as Lt,M as Ne,Y as Ue,L as Ft,bZ as St,b_ as r,j as Ot,b$ as k,aM as _t,bi as At,c0 as Pt,c1 as $t,c2 as Re,c3 as Bt,c4 as Ht,c5 as Dt,av as zt,y as Nt,bF as Ut,G as Rt,aj as re,b5 as Y,ay as ce,c6 as Wt,aE as Zt,c7 as Gt,c8 as jt}from"./index-WrGukcmu.js";const Yt={class:"flex justify-end"},Kt={key:0,class:"fixed top-[80px] right-5"},qt={key:1,class:"flex w-full items-center"},Jt={class:"flex justify-between w-full py-1 px-2 pt-3"},Qt={class:"flex items-center"},Xt=We({__name:"MissionChecklist",props:{modelValue:{type:Boolean}},emits:["update:modelValue","confirmed","dismissed"],setup(de,{emit:te}){const T=Ze(),V=Ge(),ve=de,l=te,m=ft("cockpit-pre-arm-checklist",[]),o=c({}),L=c(""),F=c(null),h=c(!1),A=E(()=>ve.modelValue),S=()=>{const p={};for(const i of m.value??[])p[i.id]=!1;o.value=p},J=E(()=>{if(!V.showChecklistBeforeArm)return!0;const p=m.value??[];return p.length>0&&p.every(i=>o.value[i.id]===!0)});g(()=>A.value,p=>{p?(S(),ye(()=>{var i,d;return(d=(i=F.value)==null?void 0:i.focus)==null?void 0:d.call(i)})):(o.value={},h.value=!1)}),g(()=>m.value,p=>{if(!A.value)return;const i={...o.value},d={};for(const x of p??[])d[x.id]=!0,x.id in i||(i[x.id]=!1);for(const x of Object.keys(i)){const P=Number(x);d[P]||delete i[P]}o.value=i},{deep:!0});const N=async()=>{var d,x;const p=L.value.trim();if(!p)return;const i={id:Date.now(),text:p};m.value.push(i),A.value&&(o.value[i.id]=!1),L.value="",await ye(),(x=(d=F.value)==null?void 0:d.focus)==null||x.call(d)},oe=p=>{if(m.value=m.value.filter(i=>i.id!==p),p in o.value){const i={...o.value};delete i[p],o.value=i}},W=()=>{l("dismissed"),l("update:modelValue",!1)},Q=()=>{l("confirmed",!0),l("update:modelValue",!1)};return je(()=>{m.value.length===0&&(m.value=[{id:Date.now(),text:"Ensure the vehicle is safe to launch"}]),A.value&&S()}),g(()=>V.showChecklistBeforeArm,p=>{p||B({message:"Pre-arm checklist disabled. You can re-enable it in Settings → Mission → Enable pre-arm checklist.",variant:"info",duration:5e3})},{immediate:!0}),(p,i)=>(w(),z(Qe,{modelValue:A.value,"onUpdate:modelValue":i[4]||(i[4]=d=>A.value=d),"max-width":"600",scrollable:"",persistent:""},{default:v(()=>[u(Ye,{style:ue(s(T).globalGlassMenuStyles),class:"rounded-lg"},{default:v(()=>[u(Ke,{class:"text-center relative pt-3"},{default:v(()=>[i[6]||(i[6]=K("h6",{class:"ml-4"},"Warning! Your vehicle is about to be armed",-1)),u(_,{icon:"",variant:"text",color:"white",class:"absolute right-1 top-1","aria-label":"Close",onClick:W},{default:v(()=>[u(De,null,{default:v(()=>i[5]||(i[5]=[D("mdi-close")])),_:1,__:[5]})]),_:1})]),_:1,__:[6]}),u(qe,{class:"mt-[-10px]"},{default:v(()=>[u(gt,{lines:"one",theme:"dark",class:"bg-transparent"},{default:v(()=>[(w(!0),q(Je,null,ht(s(m),d=>(w(),z(yt,{key:d.id,theme:"dark"},bt({prepend:v(()=>[u(ze,{modelValue:o.value[d.id],"onUpdate:modelValue":x=>o.value[d.id]=x,class:"mt-0","hide-details":"",density:"compact",disabled:!s(V).showChecklistBeforeArm},null,8,["modelValue","onUpdate:modelValue","disabled"])]),default:v(()=>[u(kt,{class:be([{"line-through opacity-60":o.value[d.id]},{"opacity-50":!s(V).showChecklistBeforeArm}])},{default:v(()=>[D(xt(d.text),1)]),_:2},1032,["class"])]),_:2},[h.value&&s(m).length>1?{name:"append",fn:v(()=>[u(_,{icon:"",variant:"text",disabled:!s(V).showChecklistBeforeArm,onClick:x=>oe(d.id)},{default:v(()=>[u(De,null,{default:v(()=>i[7]||(i[7]=[D("mdi-close")])),_:1,__:[7]})]),_:2},1032,["disabled","onClick"])]),key:"0"}:void 0]),1024))),128))]),_:1}),K("div",Yt,[h.value?(w(),q("div",qt,[h.value?(w(),z(wt,{key:0,ref_key:"newItemInput",ref:F,modelValue:L.value,"onUpdate:modelValue":i[1]||(i[1]=d=>L.value=d),disabled:!s(V).showChecklistBeforeArm,variant:"filled",density:"compact",placeholder:"Type an item and press Enter","hide-details":"",class:"ml-6 w-[80%]","append-inner-icon":"mdi-plus",onKeyup:Ct(N,["enter"]),"onClick:appendInner":N},null,8,["modelValue","disabled"])):R("",!0),u(_,{"prepend-icon":"mdi-check",disabled:!s(V).showChecklistBeforeArm,variant:"text",color:"white",size:"small",class:"elevation-1 bg-[#FFFFFF15] hover:bg-[#FFFFFF22] ml-10",onClick:i[2]||(i[2]=()=>{h.value=!1,N()})},{default:v(()=>i[9]||(i[9]=[D("Done")])),_:1,__:[9]},8,["disabled"])])):(w(),q("div",Kt,[u(_,{"prepend-icon":"mdi-format-list-checks",disabled:!s(V).showChecklistBeforeArm,variant:"text",color:"white",size:"small",class:"elevation-1 bg-[#FFFFFF15] hover:bg-[#FFFFFF22]",onClick:i[0]||(i[0]=d=>h.value=!0)},{default:v(()=>i[8]||(i[8]=[D(" Edit Items ")])),_:1,__:[8]},8,["disabled"])]))])]),_:1}),u(Mt,{class:"flex center w-[80%]",inset:""}),u(Tt,null,{default:v(()=>[K("div",Jt,[u(_,{variant:"text",onClick:W},{default:v(()=>i[10]||(i[10]=[D("Cancel")])),_:1,__:[10]}),K("div",Qt,[u(ze,{"model-value":!s(V).showChecklistBeforeArm,class:"mt-0 scale-[0.8]","hide-details":"",density:"compact","onUpdate:modelValue":i[3]||(i[3]=d=>s(V).showChecklistBeforeArm=!d)},null,8,["model-value"]),i[11]||(i[11]=K("p",{class:"text-xs text-center ml-2"},"Don't show this checklist again",-1))]),u(_,{color:"#ffffff33",class:be({"opacity-30":!J.value}),variant:"flat",disabled:!J.value,onClick:Q},{default:v(()=>i[12]||(i[12]=[D("Go")])),_:1,__:[12]},8,["class","disabled"])])]),_:1})]),_:1},8,["style"])]),_:1},8,["modelValue"]))}}),eo=Xe(Xt,[["__scopeId","data-v-b0b8e43a"]]),to=["id"],oo=We({__name:"Map",props:{widget:{}},setup(de){var He;Vt(e=>({a1a94d76:ct.value}));const te=de,T=Et(te).widget,V=Ze(),{showDialog:ve}=It(),l=Lt(),m=Ge(),o=c(),L=c(m.defaultMapZoom),F=c(m.defaultMapCenter),h=c(),A=E(()=>`map-${T.value.hash}`),S=c(!1),J=c(!1),N=c([]),oe=c(),W=c(!1),Q=c(!1),p=c(!1);let i;const d=e=>{e.touches.length>1&&(Q.value=!0,$.value&&ne(),clearTimeout(i))},x=e=>{e.touches.length<=1&&(i=window.setTimeout(()=>Q.value=!1,300))},P=c(null),I=c({});Ne.registerUsage(Ue.latitude),Ne.registerUsage(Ue.longitude),Ft(()=>{Object.keys(T.value.options).length===0&&(T.value.options={showVehiclePath:!0}),C.enableAutoUpdate()});const ke=r.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:23,maxNativeZoom:19,attribution:"© OpenStreetMap"}),xe=r.tileLayer("https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",{maxZoom:23,maxNativeZoom:19,attribution:"© Esri World Imagery"}),we=r.tileLayer("https://tiles.openseamap.org/seamark/{z}/{x}/{y}.png",{maxZoom:18,attribution:"© OpenSeaMap contributors"}),Ce=r.tileLayer.wms("https://geoserver.openseamap.org/geoserver/gwc/service/wms",{layers:"gebco2021:gebco_2021",format:"image/png",transparent:!0,version:"1.1.1",attribution:"© GEBCO, OpenSeaMap",tileSize:256,maxZoom:19}),et={OpenStreetMap:ke,"Esri World Imagery":xe},tt={Seamarks:we,"Marine Profile":Ce},Z=c(),Me=Ot(Z),Te=r.control.zoom({position:"bottomright"}),Ve=r.control.layers(et,tt);g(S,()=>{o.value!==void 0&&(S.value?(o.value.addControl(Te),o.value.addControl(Ve)):(o.value.removeControl(Te),o.value.removeControl(Ve)))}),g(Me,()=>{S.value=Me.value}),je(async()=>{var e,t;(e=Z.value)==null||e.addEventListener("touchstart",d,{passive:!0}),(t=Z.value)==null||t.addEventListener("touchend",x,{passive:!0}),o.value=r.map(A.value,{layers:[ke,xe,we,Ce],attributionControl:!1}).setView(F.value,L.value),o.value.removeControl(o.value.zoomControl),o.value.on("click",a=>{b.value=[a.latlng.lat,a.latlng.lng]}),o.value.on("moveend",()=>{if(o.value===void 0)return;let{lat:a,lng:n}=o.value.getCenter();a&&n&&(F.value=[a,n])}),o.value.on("dragstart",()=>{W.value=!0}),o.value.on("dragend",()=>{setTimeout(()=>W.value=!1,200)}),o.value.on("zoomend",()=>{var a;$.value=!1,o.value!==void 0&&(L.value=((a=o.value)==null?void 0:a.getZoom())??F.value)}),o.value.on("contextmenu",a=>{b.value=[a.latlng.lat,a.latlng.lng]}),C.enableAutoUpdate(),window.addEventListener("keydown",Se),M.value?C.goToTarget(k.VEHICLE):C.goToTarget(k.HOME),!l.isVehicleOnline&&m.vehicleMission.length&&ge(m.vehicleMission),J.value=!0,await me()});const ot={open:e=>{if(!o.value||Q.value||W.value)return;e.preventDefault(),e.stopPropagation();const t=o.value.mouseEventToContainerPoint(e),a=o.value.containerPointToLatLng(t);b.value=[a.lat,a.lng],oe.value.openAt(e),$.value=!0},close:()=>{ne()}},Ee=()=>{var e;(e=o.value)==null||e.eachLayer(t=>{(t instanceof r.Marker||t instanceof r.Polyline&&t.options.color==="#358AC3")&&o.value.removeLayer(t)}),N.value=[],ae.value=void 0,U.value=void 0,j.value=void 0},me=async()=>{J.value&&(Ee(),l.isVehicleOnline?await _e():m.vehicleMission.length&&ge(m.vehicleMission))};g(()=>l.isVehicleOnline,()=>{me()}),g(()=>m.vehicleMissionRevision,()=>{me()}),_t(()=>{var e,t;C.disableAutoUpdate(),window.removeEventListener("keydown",Se),o.value&&(o.value.off("contextmenu"),Object.values(I.value).forEach(a=>a.remove()),I.value={}),(e=Z.value)==null||e.removeEventListener("touchstart",d),(t=Z.value)==null||t.removeEventListener("touchend",x)}),g(F,(e,t)=>{var a;e.toString()!==t.toString()&&((a=o.value)==null||a.panTo(e))}),g(o,(e,t)=>{o.value!==void 0&&(e==null?void 0:e.options)===void 0&&(o.value=t)}),g(L,(e,t)=>{var a;e!==t&&($.value=!1,(a=o.value)==null||a.setZoom(L.value))}),g(te.widget,()=>{var e;(e=o.value)==null||e.invalidateSize()});const G=c(void 0),C=new St(e=>G.value=e,e=>F.value=e);C.setTrackableTarget(k.VEHICLE,()=>M.value),C.setTrackableTarget(k.HOME,()=>h.value);const M=E(()=>l.coordinates.latitude?[l.coordinates.latitude,l.coordinates.longitude]:void 0),pe=E(()=>{var e;return l.attitude.yaw?At((e=l.attitude)==null?void 0:e.yaw):0}),Ie=E(()=>{const e=l.lastHeartbeat;return e?`${Pt(e??0,{includeSeconds:!0})} ago`:"never"}),{history:at}=$t(M);(He=navigator==null?void 0:navigator.geolocation)==null||He.watchPosition(e=>{h.value||(h.value=[e.coords.latitude,e.coords.longitude])},e=>console.error(`Failed to get position: (${e.code}) ${e.message}`),{enableHighAccuracy:!1,timeout:5e3,maximumAge:0});let Le=!0;g([h,o],async()=>{h.value===F.value||!o.value||!Le||(C.goToTarget(k.HOME),Le=!1)});const H=c();g(l.coordinates,()=>{if(!(!o.value||!M.value)){if(H.value===void 0){let e=Bt;l.vehicleType===Re.MAV_TYPE_SURFACE_BOAT?e=Ht:l.vehicleType===Re.MAV_TYPE_SUBMARINE&&(e=Dt);const t=r.divIcon({className:"vehicle-marker",html:`<img src="${e}" style="width: 64px; height: 64px;">`,iconSize:[64,64],iconAnchor:[32,32]});H.value=r.marker(M.value,{icon:t});const a=r.tooltip({content:"No data available",className:"waypoint-tooltip",offset:[40,0]});H.value.bindTooltip(a),o.value.addLayer(H.value)}H.value.setLatLng(M.value)}}),g(M,(e,t)=>{G.value===k.VEHICLE||t!==void 0||C.follow(k.VEHICLE)}),g([M,pe,Ie,()=>l.isArmed],()=>{var t,a,n,y,f;if(H.value===void 0)return;(y=H.value.getTooltip())==null||y.setContent(`
    <p>Coordinates: ${(t=M.value)==null?void 0:t[0].toFixed(6)}, ${(a=M.value)==null?void 0:a[1].toFixed(6)}</p>
    <p>Velocity: ${((n=l.velocity.ground)==null?void 0:n.toFixed(2))??"N/A"} m/s</p>
    <p>Heading: ${pe.value.toFixed(2)}°</p>
    <p>${l.isArmed?"Armed":"Disarmed"}</p>
    <p>Last seen: ${Ie.value}</p>
  `);const e=(f=H.value.getElement())==null?void 0:f.querySelector("img");e&&(e.style.transform=`rotate(${pe.value}deg)`)});const U=c();g(h,()=>{if(o.value===void 0)return;const e=h.value;if(e!==void 0)if(U.value)U.value.setLatLng(e);else{U.value=r.marker(e,{icon:r.divIcon({className:"marker-icon",iconSize:[24,24],iconAnchor:[12,12]}),draggable:!0});const t=r.tooltip({content:'<i class="mdi mdi-home-map-marker text-[18px] "></i>',permanent:!0,direction:"center",className:"waypoint-tooltip",opacity:1});U.value.bindTooltip(t),U.value.on("dragend",a=>{const y=a.target.getLatLng();he([y.lat,y.lng])}),o.value.addLayer(U.value)}});const ae=c();g(N,e=>{o.value&&(ae.value||(ae.value=r.polyline([],{color:"#358AC3"}).addTo(o.value)),ae.value.setLatLngs(e.map(t=>t.coordinates)),e.forEach((t,a)=>{var f;const n=r.marker(t.coordinates);n.setIcon(r.divIcon({className:"marker-icon",iconSize:[16,16],iconAnchor:[8,8]}));const y=r.tooltip({content:a.toString(),permanent:!0,direction:"center",className:"waypoint-tooltip",opacity:1});n.bindTooltip(y),(f=o.value)==null||f.addLayer(n)}))},{deep:!0});const fe=c();g(at,e=>{if(o.value===void 0||e===void 0)return;fe.value===void 0&&(fe.value=r.polyline([],{color:"#ffff00"}).addTo(o.value));const t=e.filter(a=>a.snapshot!==void 0).map(a=>a.snapshot);fe.value.setLatLngs(t)});const $=c(!1),b=c(null),Fe=c(),it=zt([{item:"Set home waypoint",action:()=>ie("set-home-waypoint"),icon:"mdi-home-map-marker"},{item:"Place Point of Interest",action:()=>ie("place-poi"),icon:"mdi-map-marker-plus"},{item:"GoTo",action:()=>ie("goto"),icon:"mdi-crosshairs-gps"},{item:"Set default map position",action:()=>ie("set-default-map-position"),icon:"mdi-map-check"}]),j=c(),nt=async()=>{var e;if(!(!o.value||!b.value))try{await m.setDefaultMapPosition(b.value,L.value),B({message:"Default map position set",variant:"success"});const t=r.marker(b.value,{icon:r.divIcon({className:"marker-icon",iconSize:[24,24],iconAnchor:[12,12]})}).addTo(o.value),a=r.tooltip({content:'<i class="mdi mdi-map-check text-[18px] border-[1px] rounded-full px-[2px] py-[1px]"></i>',permanent:!0,direction:"center",className:"waypoint-tooltip",opacity:1});t.bindTooltip(a).openTooltip();const n=t.getElement(),y=(e=t.getTooltip())==null?void 0:e.getElement();[n,y].forEach(f=>{f&&(f.style.transition="opacity 1s",f.style.opacity="1")}),setTimeout(()=>{[n,y].forEach(f=>{f&&(f.style.opacity="0")}),setTimeout(()=>{var f;(f=o.value)==null||f.removeLayer(t)},1e3)},1500)}catch(t){console.error(t),B({message:"Failed to set default map position",variant:"error"})}},st=async()=>{if(!b.value||!o.value)return;j.value&&(o.value.removeLayer(j.value),j.value=void 0),j.value=r.marker(b.value,{icon:r.divIcon({className:"marker-icon",iconSize:[24,24],iconAnchor:[12,12]})}).addTo(o.value);const e=r.tooltip({content:'<i class="mdi mdi-crosshairs-gps border-[1px] rounded-full text-[18px] px-[2px] pt-[1px] "></i>',permanent:!0,direction:"center",className:"waypoint-tooltip",opacity:1});if(j.value.bindTooltip(e),b.value){const f=l.coordinates.altitude??0,O=b.value[0],ee=b.value[1];try{await l.goTo(0,0,0,0,O,ee,f)}catch(le){B({message:`GoTo request failed: ${le.message}`,variant:"error"})}}},ie=async e=>{switch(e){case"goto":{st();break}case"set-default-map-position":nt();break;case"place-poi":b.value&&P.value?P.value.openDialog(b.value):b.value?P.value||(B({message:"POI Manager (map widget) is not available.",variant:"error"}),console.error("Cannot open POI dialog, POI Manager (map widget) ref is not set.")):(B({message:"Cannot place Point of Interest without map coordinates.",variant:"error"}),console.error("Cannot open POI dialog without click coordinates for new POI"));break;case"set-home-waypoint":b.value&&he(b.value);break;default:console.warn("Unknown menu option selected:",e)}$.value=!1},ne=()=>{$.value=!1,o.value!==void 0&&Fe.value!==void 0&&o.value.removeLayer(Fe.value)},Se=e=>{e.key==="Escape"&&ne()},ge=e=>{e.forEach((t,a)=>{a===0?(h.value=t.coordinates,he(t.coordinates)):N.value.push(t)})},se=c(!1),Oe=c(0),_e=async()=>{se.value=!0,Ee();const e=async t=>{Oe.value=t};try{const t=await l.fetchMission(e);ge(t),B({variant:"success",message:"Mission download succeeded!",duration:3e3})}catch(t){ve({variant:"error",title:"Mission download failed",message:t,timer:5e3})}finally{se.value=!1}},he=async e=>{const t=[e[0],e[1]];h.value=t,await l.setHomeWaypoint(t,0),$.value&&($.value=!1)},lt=async()=>{if(m.showChecklistBeforeArm===!0){p.value=!0;return}try{await l.startMission()}catch{B({message:"Failed to start mission.",variant:"error"})}},rt=async e=>{if(e)try{await l.startMission()}catch{B({message:"Failed to start mission.",variant:"error"})}},X=Nt(),ct=E(()=>`${Math.max(-X.widgetClearanceForVisibleArea(T.value).bottom,0)}px`),Ae=E(()=>`${Math.max(-X.widgetClearanceForVisibleArea(T.value).top,0)}px`),ut=E(()=>l.isVehicleOnline?"Download the mission that is stored in the vehicle.":"Cannot download mission (vehicle offline)."),dt=E(()=>l.isVehicleOnline?"Execute the mission that is stored in the vehicle.":"Cannot execute mission (vehicle offline)."),vt=E(()=>h.value===void 0?"Cannot center map on home (home position undefined).":G.value===k.HOME?"Tracking home position. Click to stop tracking.":"Click once to center on home or twice to track it."),mt=E(()=>l.isVehicleOnline?M.value===void 0?"Cannot center map on vehicle (vehicle position undefined).":G.value===k.VEHICLE?"Tracking vehicle position. Click to stop tracking.":"Click once to center on vehicle or twice to track it.":"Cannot center map on vehicle (vehicle offline)."),Pe=e=>({html:`
    <div class="poi-marker-container">
      <div class="poi-marker-background" style="background-color: ${e.color}80;"></div>
      <i class="v-icon notranslate mdi ${e.icon}" style="color: rgba(255, 255, 255, 0.7); position: relative; z-index: 2;"></i>
    </div>
  `,className:"poi-marker-icon-widget",iconSize:[32,32],iconAnchor:[16,32]}),$e=e=>{if(!o.value||!o.value.getContainer())return;const t=r.divIcon(Pe(e)),a=r.marker(e.coordinates,{icon:t,draggable:!0}).addTo(o.value),n=`
    <strong>${e.name}</strong><br>
    ${e.description?e.description+"<br>":""}
    Lat: ${e.coordinates[0].toFixed(8)}, Lng: ${e.coordinates[1].toFixed(8)}
  `,y={permanent:!1,direction:"top",offset:[0,-40],className:"poi-tooltip-widget"};a.bindTooltip(n,y),a.on("drag",f=>{var le;const O=f.target.getLatLng(),ee=`
      <strong>${e.name}</strong><br>
      ${e.description?e.description+"<br>":""}
      Lat: ${O.lat.toFixed(8)}, Lng: ${O.lng.toFixed(8)}
    `;(le=a.getTooltip())==null||le.setContent(ee)}),a.on("dragend",f=>{const O=f.target.getLatLng();m.movePointOfInterest(e.id,[O.lat,O.lng])}),a.on("click",f=>{if(r.DomEvent.stopPropagation(f),P.value){const O=m.pointsOfInterest.find(ee=>ee.id===e.id);O?P.value.openDialog(void 0,O):console.warn("POI not found in store:",e.id)}}),I.value[e.id]=a},Be=e=>{var n;if(!o.value||!o.value.getContainer()||!I.value[e.id])return;const t=I.value[e.id];t.setLatLng(e.coordinates),t.setIcon(r.divIcon(Pe(e)));const a=`
    <strong>${e.name}</strong><br>
    ${e.description?e.description+"<br>":""}
    Lat: ${e.coordinates[0].toFixed(8)}, Lng: ${e.coordinates[1].toFixed(8)}
  `;(n=t.getTooltip())==null||n.setContent(a)},pt=e=>{!o.value||!I.value[e]||(I.value[e].remove(),delete I.value[e])};return g(()=>m.pointsOfInterest,async e=>{if((!o.value||!o.value.getContainer())&&(await ye(),!o.value||!o.value.getContainer())){console.warn("Map.vue: POI watcher - map not ready after nextTick.");return}const t=new Set(e.map(a=>a.id));Object.keys(I.value).forEach(a=>{t.has(a)||pt(a)}),e.forEach(a=>{I.value[a.id]?Be(a):$e(a)})},{deep:!0,immediate:!0}),g(o,e=>{e&&e.getContainer()&&m.pointsOfInterest.forEach(t=>{I.value[t.id]?Be(t):$e(t)})},{immediate:!0}),(e,t)=>{const a=Ut("contextmenu");return w(),q(Je,null,[Rt((w(),q("div",{ref_key:"mapBase",ref:Z,class:be(["page-base",s(X).editingMode?"pointer-events-none":"pointer-events-auto"])},[K("div",{id:A.value,ref_key:"map",ref:o,class:"map"},[u(ce,{location:"top",text:vt.value},{activator:v(({props:n})=>[S.value?(w(),z(_,re({key:0},n,{class:["absolute right-[166px] m-3 bottom-button bg-slate-50 text-[14px]",h.value?"":"active-events-on-disabled"],color:G.value==s(k).HOME?"red":"",elevation:"2",style:{"z-index":"1002","border-radius":"0px"},icon:"mdi-home-search",size:"x-small",disabled:!h.value,onClick:t[0]||(t[0]=Y(y=>s(C).goToTarget(s(k).HOME,!0),["stop"])),onDblclick:t[1]||(t[1]=Y(y=>s(C).follow(s(k).HOME),["stop"]))}),null,16,["class","color","disabled"])):R("",!0)]),_:1},8,["text"]),u(ce,{location:"top",text:mt.value},{activator:v(({props:n})=>[S.value?(w(),z(_,re({key:0},n,{class:["absolute m-3 bottom-button right-[124px] bg-slate-50 text-[14px]",M.value?"":"active-events-on-disabled"],color:G.value==s(k).VEHICLE?"red":"",elevation:"2",style:{"z-index":"1002","border-radius":"0px"},icon:"mdi-airplane-marker",size:"x-small",disabled:!M.value,onClick:t[2]||(t[2]=Y(y=>s(C).goToTarget(s(k).VEHICLE,!0),["stop"])),onDblclick:t[3]||(t[3]=Y(y=>s(C).follow(s(k).VEHICLE),["stop"]))}),null,16,["class","color","disabled"])):R("",!0)]),_:1},8,["text"]),u(ce,{location:"top",text:ut.value},{activator:v(({props:n})=>[S.value?(w(),z(_,re({key:0},n,{class:["absolute m-3 bottom-button right-[82px] bg-slate-50 text-[14px]",s(l).isVehicleOnline?"":"active-events-on-disabled"],disabled:!s(l).isVehicleOnline,elevation:"2",style:{"z-index":"1002","border-radius":"0px"},icon:"mdi-download",size:"x-small",onClick:Y(_e,["stop"])}),null,16,["class","disabled"])):R("",!0)]),_:1},8,["text"]),u(ce,{location:"top",text:dt.value},{activator:v(({props:n})=>[S.value?(w(),z(_,re({key:0},n,{class:["absolute mb-3 ml-1 bottom-button right-[52px] bg-slate-50 text-[14px]",s(l).isVehicleOnline?"":"active-events-on-disabled"],disabled:!s(l).isVehicleOnline,elevation:"2",style:{"z-index":"1002","border-radius":"0px"},icon:"mdi-play",size:"x-small",onClick:Y(lt,["stop"])}),null,16,["class","disabled"])):R("",!0)]),_:1},8,["text"])],8,to)],2)),[[a,ot]]),u(Wt,{ref_key:"contextMenuRef",ref:oe,visible:$.value,width:"260px","menu-items":it,onClose:ne},null,8,["visible","menu-items"]),u(Qe,{modelValue:s(X).widgetManagerVars(s(T).hash).configMenuOpen,"onUpdate:modelValue":t[5]||(t[5]=n=>s(X).widgetManagerVars(s(T).hash).configMenuOpen=n),width:"auto"},{default:v(()=>[u(Ye,{class:"pa-2",style:ue(s(V).globalGlassMenuStyles)},{default:v(()=>[u(Ke,{class:"text-center"},{default:v(()=>t[8]||(t[8]=[D("Map widget settings")])),_:1,__:[8]}),u(qe,null,{default:v(()=>[u(Zt,{modelValue:s(T).options.showVehiclePath,"onUpdate:modelValue":t[4]||(t[4]=n=>s(T).options.showVehiclePath=n),class:"my-1",label:"Show vehicle path",color:s(T).options.showVehiclePath?"white":void 0,"hide-details":""},null,8,["modelValue","color"])]),_:1})]),_:1},8,["style"])]),_:1},8,["modelValue"]),se.value?(w(),z(Gt,{key:0,"model-value":Oe.value,height:"10",absolute:"",bottom:"",color:"white",style:ue(`top: ${Ae.value}`)},null,8,["model-value","style"])):R("",!0),se.value?(w(),q("p",{key:1,style:ue({top:Ae.value}),class:"absolute left-[7px] mt-4 flex text-md font-bold text-white z-30 drop-shadow-md"}," Loading mission... ",4)):R("",!0),u(jt,{ref_key:"poiManagerMapWidgetRef",ref:P},null,512),u(eo,{"model-value":p.value,onConfirmed:t[6]||(t[6]=n=>rt(n)),"onUpdate:modelValue":t[7]||(t[7]=n=>p.value=n)},null,8,["model-value"])],64)}}}),io=Xe(oo,[["__scopeId","data-v-3ea981b1"]]);export{io as default};
