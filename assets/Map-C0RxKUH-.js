import{c as qe,K as Je,aR as Qe,aY as kt,r,k as I,w as h,bm as ke,o as Xe,aZ as L,I as N,m as w,N as p,H as c,V as et,O as se,v as n,P as tt,n as U,ai as F,ag as Ze,Q as H,R as at,a_ as wt,l as W,F as ot,q as Ct,a$ as Mt,bY as Tt,bo as Vt,x as we,t as it,S as Ge,s as z,U as Et,bd as It,aN as St,bR as Lt,W as lt,_ as st,bO as Ot,J as _t,aG as Ft,u as $t,M as je,Y as Ye,L as At,bZ as Pt,b_ as le,j as Bt,b$ as m,c0 as k,aM as Dt,bi as Ht,c1 as zt,c2 as Nt,c3 as Ke,c4 as Rt,c5 as Ut,c6 as Wt,av as Zt,y as Gt,bF as jt,G as Yt,aj as me,b5 as q,ay as pe,c7 as Kt,aE as qt,c8 as Jt,c9 as Qt}from"./index-CZoNGeDq.js";const Xt={class:"flex justify-end"},ea={key:0,class:"fixed top-[80px] right-5"},ta={key:1,class:"flex w-full items-center"},aa={class:"flex justify-between w-full py-1 px-2 pt-3"},oa={class:"flex items-center"},ia=qe({__name:"MissionChecklist",props:{modelValue:{type:Boolean}},emits:["update:modelValue","confirmed","dismissed"],setup(fe,{emit:ne}){const E=Je(),C=Qe(),J=fe,$=ne,s=kt("cockpit-pre-arm-checklist",[]),v=r({}),a=r(""),A=r(null),M=r(!1),y=I(()=>J.modelValue),Q=()=>{const f={};for(const o of s.value??[])f[o.id]=!1;v.value=f},O=I(()=>{if(!C.showChecklistBeforeArm)return!0;const f=s.value??[];return f.length>0&&f.every(o=>v.value[o.id]===!0)});h(()=>y.value,f=>{f?(Q(),ke(()=>{var o,u;return(u=(o=A.value)==null?void 0:o.focus)==null?void 0:u.call(o)})):(v.value={},M.value=!1)}),h(()=>s.value,f=>{if(!y.value)return;const o={...v.value},u={};for(const x of f??[])u[x.id]=!0,x.id in o||(o[x.id]=!1);for(const x of Object.keys(o)){const P=Number(x);u[P]||delete o[P]}v.value=o},{deep:!0});const Z=async()=>{var u,x;const f=a.value.trim();if(!f)return;const o={id:Date.now(),text:f};s.value.push(o),y.value&&(v.value[o.id]=!1),a.value="",await ke(),(x=(u=A.value)==null?void 0:u.focus)==null||x.call(u)},X=f=>{if(s.value=s.value.filter(o=>o.id!==f),f in v.value){const o={...v.value};delete o[f],v.value=o}},ee=()=>{$("dismissed"),$("update:modelValue",!1)},te=()=>{$("confirmed",!0),$("update:modelValue",!1)};return Xe(()=>{s.value.length===0&&(s.value=[{id:Date.now(),text:"Ensure the vehicle is safe to launch"}]),y.value&&Q()}),h(()=>C.showChecklistBeforeArm,f=>{f||L({message:"Pre-arm checklist disabled. You can re-enable it in Settings → Mission → Enable pre-arm checklist.",variant:"info",duration:5e3})},{immediate:!0}),(f,o)=>(w(),N(lt,{modelValue:y.value,"onUpdate:modelValue":o[4]||(o[4]=u=>y.value=u),"max-width":"600",scrollable:"",persistent:""},{default:p(()=>[c(et,{style:se(n(E).globalGlassMenuStyles),class:"rounded-lg"},{default:p(()=>[c(tt,{class:"text-center relative pt-3"},{default:p(()=>[o[6]||(o[6]=U("h6",{class:"ml-4"},"Warning! Your vehicle is about to be armed",-1)),c(F,{icon:"",variant:"text",color:"white",class:"absolute right-1 top-1","aria-label":"Close",onClick:ee},{default:p(()=>[c(Ze,null,{default:p(()=>o[5]||(o[5]=[H("mdi-close")])),_:1,__:[5]})]),_:1})]),_:1,__:[6]}),c(at,{class:"mt-[-10px]"},{default:p(()=>[c(wt,{lines:"one",theme:"dark",class:"bg-transparent"},{default:p(()=>[(w(!0),W(ot,null,Ct(n(s),u=>(w(),N(Mt,{key:u.id,theme:"dark"},Tt({prepend:p(()=>[c(Ge,{modelValue:v.value[u.id],"onUpdate:modelValue":x=>v.value[u.id]=x,class:"mt-0","hide-details":"",density:"compact",disabled:!n(C).showChecklistBeforeArm},null,8,["modelValue","onUpdate:modelValue","disabled"])]),default:p(()=>[c(Vt,{class:we([{"line-through opacity-60":v.value[u.id]},{"opacity-50":!n(C).showChecklistBeforeArm}])},{default:p(()=>[H(it(u.text),1)]),_:2},1032,["class"])]),_:2},[M.value&&n(s).length>1?{name:"append",fn:p(()=>[c(F,{icon:"",variant:"text",disabled:!n(C).showChecklistBeforeArm,onClick:x=>X(u.id)},{default:p(()=>[c(Ze,null,{default:p(()=>o[7]||(o[7]=[H("mdi-close")])),_:1,__:[7]})]),_:2},1032,["disabled","onClick"])]),key:"0"}:void 0]),1024))),128))]),_:1}),U("div",Xt,[M.value?(w(),W("div",ta,[M.value?(w(),N(Et,{key:0,ref_key:"newItemInput",ref:A,modelValue:a.value,"onUpdate:modelValue":o[1]||(o[1]=u=>a.value=u),disabled:!n(C).showChecklistBeforeArm,variant:"filled",density:"compact",placeholder:"Type an item and press Enter","hide-details":"",class:"ml-6 w-[80%]","append-inner-icon":"mdi-plus",onKeyup:It(Z,["enter"]),"onClick:appendInner":Z},null,8,["modelValue","disabled"])):z("",!0),c(F,{"prepend-icon":"mdi-check",disabled:!n(C).showChecklistBeforeArm,variant:"text",color:"white",size:"small",class:"elevation-1 bg-[#FFFFFF15] hover:bg-[#FFFFFF22] ml-10",onClick:o[2]||(o[2]=()=>{M.value=!1,Z()})},{default:p(()=>o[9]||(o[9]=[H("Done")])),_:1,__:[9]},8,["disabled"])])):(w(),W("div",ea,[c(F,{"prepend-icon":"mdi-format-list-checks",disabled:!n(C).showChecklistBeforeArm,variant:"text",color:"white",size:"small",class:"elevation-1 bg-[#FFFFFF15] hover:bg-[#FFFFFF22]",onClick:o[0]||(o[0]=u=>M.value=!0)},{default:p(()=>o[8]||(o[8]=[H(" Edit Items ")])),_:1,__:[8]},8,["disabled"])]))])]),_:1}),c(St,{class:"flex center w-[80%]",inset:""}),c(Lt,null,{default:p(()=>[U("div",aa,[c(F,{variant:"text",onClick:ee},{default:p(()=>o[10]||(o[10]=[H("Cancel")])),_:1,__:[10]}),U("div",oa,[c(Ge,{"model-value":!n(C).showChecklistBeforeArm,class:"mt-0 scale-[0.8]","hide-details":"",density:"compact","onUpdate:modelValue":o[3]||(o[3]=u=>n(C).showChecklistBeforeArm=!u)},null,8,["model-value"]),o[11]||(o[11]=U("p",{class:"text-xs text-center ml-2"},"Don't show this checklist again",-1))]),c(F,{color:"#ffffff33",class:we({"opacity-30":!O.value}),variant:"flat",disabled:!O.value,onClick:te},{default:p(()=>o[12]||(o[12]=[H("Go")])),_:1,__:[12]},8,["class","disabled"])])]),_:1})]),_:1},8,["style"])]),_:1},8,["modelValue"]))}}),la=st(ia,[["__scopeId","data-v-b0b8e43a"]]),sa=["id"],na=qe({__name:"Map",props:{widget:{}},setup(fe){var We;Ot(e=>({f7757564:ft.value}));const ne=fe,E=_t(ne).widget,C=Je(),{showDialog:J,closeDialog:$}=Ft(),s=$t(),v=Qe(),a=r(),A=r(v.defaultMapZoom),M=r(v.defaultMapCenter),y=r(),Q=I(()=>`map-${E.value.hash}`),O=r(!1),Z=r(!1),X=r([]),ee=r(),te=r(!1),f=r(!1),o=r(!1),u=r(!1),x=r(0),P=r(0);let Ce;const Me=e=>{e.touches.length>1&&(f.value=!0,B.value&&ue(),clearTimeout(Ce))},Te=e=>{e.touches.length<=1&&(Ce=window.setTimeout(()=>f.value=!1,300))},G=r(null),S=r({});je.registerUsage(Ye.latitude),je.registerUsage(Ye.longitude),At(()=>{Object.keys(E.value.options).length===0&&(E.value.options={showVehiclePath:!0}),T.enableAutoUpdate()});const Ve=le.tileLayerOffline("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:23,maxNativeZoom:19,attribution:"© OpenStreetMap"}),ae=le.tileLayerOffline("https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",{maxZoom:23,maxNativeZoom:19,attribution:"© Esri World Imagery"}),Ee=le.tileLayerOffline("https://tiles.openseamap.org/seamark/{z}/{x}/{y}.png",{maxZoom:18,attribution:"© OpenSeaMap contributors"}),Ie=le.tileLayerOffline("https://geoserver.openseamap.org/geoserver/gwc/service/wms",{layers:"gebco2021:gebco_2021",format:"image/png",transparent:!0,version:"1.1.1",attribution:"© GEBCO, OpenSeaMap",tileSize:256,maxZoom:19}),nt={OpenStreetMap:Ve,"Esri World Imagery":ae},rt={Seamarks:Ee,"Marine Profile":Ie},j=r(),Se=Bt(j),Le=m.control.zoom({position:"bottomright"}),Oe=m.control.layers(nt,rt);h(O,()=>{a.value!==void 0&&(O.value?(a.value.addControl(Le),a.value.addControl(Oe)):(a.value.removeControl(Le),a.value.removeControl(Oe)))}),h(Se,()=>{O.value=Se.value}),Xe(async()=>{var t,i;(t=j.value)==null||t.addEventListener("touchstart",Me,{passive:!0}),(i=j.value)==null||i.addEventListener("touchend",Te,{passive:!0}),a.value=m.map(Q.value,{layers:[Ve,ae,Ee,Ie],attributionControl:!1}).setView(M.value,A.value),a.value.removeControl(a.value.zoomControl),a.value.on("click",l=>{b.value=[l.latlng.lat,l.latlng.lng]}),a.value.on("moveend",()=>{if(a.value===void 0)return;let{lat:l,lng:d}=a.value.getCenter();l&&d&&(M.value=[l,d])});const e=le.savetiles(ae,{saveWhatYouSee:!0,maxZoom:19,alwaysDownload:!1,position:"topright",parallel:20,confirm(l,d){J({variant:"info",message:`Save ${l._tilesforSave.length} tiles for offline use?`,persistent:!1,timer:void 0,maxWidth:"450px",actions:[{text:"Cancel",color:"white",action:$},{text:"Save tiles",color:"white",action:()=>{d(),$()}}]})},confirmRemoval(l,d){J({variant:"warning",message:"Remove all saved tiles for this layer?",persistent:!1,timer:void 0,maxWidth:"450px",actions:[{text:"Cancel",color:"white",action:$},{text:"Remove tiles",color:"white",action:()=>{d(),$(),L({message:"Offline tiles removed",variant:"info",duration:3e3})}}]})},saveText:'<i class="mdi mdi-download" title="Save tiles"></i>',rmText:'<i class="mdi mdi-trash-can" title="Remove tiles"></i>'});a.value&&e.addTo(a.value),ae.on("savestart",l=>{var d;x.value=0,P.value=((d=l._tilesforSave)==null?void 0:d.length)??0,L({message:`Saving ${P.value} tiles...`,variant:"info",duration:2e3}),u.value=!0}),ae.on("loadtileend",()=>{x.value+=1,x.value===P.value&&P.value>0&&(L({message:"Offline tiles saved!",variant:"success",duration:3e3}),u.value=!1)}),a.value.on("dragstart",()=>{te.value=!0}),a.value.on("dragend",()=>{setTimeout(()=>te.value=!1,200)}),a.value.on("zoomend",()=>{var l;B.value=!1,a.value!==void 0&&(A.value=((l=a.value)==null?void 0:l.getZoom())??M.value)}),a.value.on("contextmenu",l=>{b.value=[l.latlng.lat,l.latlng.lng]}),T.enableAutoUpdate(),window.addEventListener("keydown",Pe),V.value?T.goToTarget(k.VEHICLE):T.goToTarget(k.HOME),!s.isVehicleOnline&&v.vehicleMission.length&&xe(v.vehicleMission),Z.value=!0,await ge()});const ct={open:e=>{if(!a.value||f.value||te.value)return;e.preventDefault(),e.stopPropagation();const t=a.value.mouseEventToContainerPoint(e),i=a.value.containerPointToLatLng(t);b.value=[i.lat,i.lng],ee.value.openAt(e),B.value=!0},close:()=>{ue()}},_e=()=>{var e;(e=a.value)==null||e.eachLayer(t=>{(t instanceof m.Marker||t instanceof m.Polyline&&t.options.color==="#358AC3")&&a.value.removeLayer(t)}),X.value=[],re.value=void 0,R.value=void 0,K.value=void 0},ge=async()=>{Z.value&&(_e(),s.isVehicleOnline?await De():v.vehicleMission.length&&xe(v.vehicleMission))};h(()=>s.isVehicleOnline,()=>{ge()}),h(()=>v.vehicleMissionRevision,()=>{ge()}),Dt(()=>{var e,t;T.disableAutoUpdate(),window.removeEventListener("keydown",Pe),a.value&&(a.value.off("contextmenu"),Object.values(S.value).forEach(i=>i.remove()),S.value={}),(e=j.value)==null||e.removeEventListener("touchstart",Me),(t=j.value)==null||t.removeEventListener("touchend",Te)}),h(M,(e,t)=>{var i;e.toString()!==t.toString()&&((i=a.value)==null||i.panTo(e))}),h(a,(e,t)=>{a.value!==void 0&&(e==null?void 0:e.options)===void 0&&(a.value=t)}),h(A,(e,t)=>{var i;e!==t&&(B.value=!1,(i=a.value)==null||i.setZoom(A.value))}),h(ne.widget,()=>{var e;(e=a.value)==null||e.invalidateSize()});const Y=r(void 0),T=new Pt(e=>Y.value=e,e=>M.value=e);T.setTrackableTarget(k.VEHICLE,()=>V.value),T.setTrackableTarget(k.HOME,()=>y.value);const V=I(()=>s.coordinates.latitude?[s.coordinates.latitude,s.coordinates.longitude]:void 0),he=I(()=>{var e;return s.attitude.yaw?Ht((e=s.attitude)==null?void 0:e.yaw):0}),Fe=I(()=>{const e=s.lastHeartbeat;return e?`${zt(e??0,{includeSeconds:!0})} ago`:"never"}),{history:ut}=Nt(V);(We=navigator==null?void 0:navigator.geolocation)==null||We.watchPosition(e=>{y.value||(y.value=[e.coords.latitude,e.coords.longitude])},e=>console.error(`Failed to get position: (${e.code}) ${e.message}`),{enableHighAccuracy:!1,timeout:5e3,maximumAge:0});let $e=!0;h([y,a],async()=>{y.value===M.value||!a.value||!$e||(T.goToTarget(k.HOME),$e=!1)});const D=r();h(s.coordinates,()=>{if(!(!a.value||!V.value)){if(D.value===void 0){let e=Rt;s.vehicleType===Ke.MAV_TYPE_SURFACE_BOAT?e=Ut:s.vehicleType===Ke.MAV_TYPE_SUBMARINE&&(e=Wt);const t=m.divIcon({className:"vehicle-marker",html:`<img src="${e}" style="width: 64px; height: 64px;">`,iconSize:[64,64],iconAnchor:[32,32]});D.value=m.marker(V.value,{icon:t});const i=m.tooltip({content:"No data available",className:"waypoint-tooltip",offset:[40,0]});D.value.bindTooltip(i),a.value.addLayer(D.value)}D.value.setLatLng(V.value)}}),h(V,(e,t)=>{Y.value===k.VEHICLE||t!==void 0||T.follow(k.VEHICLE)}),h([V,he,Fe,()=>s.isArmed],()=>{var t,i,l,d,g;if(D.value===void 0)return;(d=D.value.getTooltip())==null||d.setContent(`
    <p>Coordinates: ${(t=V.value)==null?void 0:t[0].toFixed(6)}, ${(i=V.value)==null?void 0:i[1].toFixed(6)}</p>
    <p>Velocity: ${((l=s.velocity.ground)==null?void 0:l.toFixed(2))??"N/A"} m/s</p>
    <p>Heading: ${he.value.toFixed(2)}°</p>
    <p>${s.isArmed?"Armed":"Disarmed"}</p>
    <p>Last seen: ${Fe.value}</p>
  `);const e=(g=D.value.getElement())==null?void 0:g.querySelector("img");e&&(e.style.transform=`rotate(${he.value}deg)`)});const R=r();h(y,()=>{if(a.value===void 0)return;const e=y.value;if(e!==void 0)if(R.value)R.value.setLatLng(e);else{R.value=m.marker(e,{icon:m.divIcon({className:"marker-icon",iconSize:[24,24],iconAnchor:[12,12]}),draggable:!0});const t=m.tooltip({content:'<i class="mdi mdi-home-map-marker text-[18px] "></i>',permanent:!0,direction:"center",className:"waypoint-tooltip",opacity:1});R.value.bindTooltip(t),R.value.on("dragend",i=>{const d=i.target.getLatLng();be([d.lat,d.lng])}),a.value.addLayer(R.value)}});const re=r();h(X,e=>{a.value&&(re.value||(re.value=m.polyline([],{color:"#358AC3"}).addTo(a.value)),re.value.setLatLngs(e.map(t=>t.coordinates)),e.forEach((t,i)=>{var g;const l=m.marker(t.coordinates);l.setIcon(m.divIcon({className:"marker-icon",iconSize:[16,16],iconAnchor:[8,8]}));const d=m.tooltip({content:i.toString(),permanent:!0,direction:"center",className:"waypoint-tooltip",opacity:1});l.bindTooltip(d),(g=a.value)==null||g.addLayer(l)}))},{deep:!0});const ye=r();h(ut,e=>{if(a.value===void 0||e===void 0)return;ye.value===void 0&&(ye.value=m.polyline([],{color:"#ffff00"}).addTo(a.value));const t=e.filter(i=>i.snapshot!==void 0).map(i=>i.snapshot);ye.value.setLatLngs(t)});const B=r(!1),b=r(null),Ae=r(),dt=Zt([{item:"Set home waypoint",action:()=>ce("set-home-waypoint"),icon:"mdi-home-map-marker"},{item:"Place Point of Interest",action:()=>ce("place-poi"),icon:"mdi-map-marker-plus"},{item:"GoTo",action:()=>ce("goto"),icon:"mdi-crosshairs-gps"},{item:"Set default map position",action:()=>ce("set-default-map-position"),icon:"mdi-map-check"}]),K=r(),vt=async()=>{var e;if(!(!a.value||!b.value))try{await v.setDefaultMapPosition(b.value,A.value),L({message:"Default map position set",variant:"success"});const t=m.marker(b.value,{icon:m.divIcon({className:"marker-icon",iconSize:[24,24],iconAnchor:[12,12]})}).addTo(a.value),i=m.tooltip({content:'<i class="mdi mdi-map-check text-[18px] border-[1px] rounded-full px-[2px] py-[1px]"></i>',permanent:!0,direction:"center",className:"waypoint-tooltip",opacity:1});t.bindTooltip(i).openTooltip();const l=t.getElement(),d=(e=t.getTooltip())==null?void 0:e.getElement();[l,d].forEach(g=>{g&&(g.style.transition="opacity 1s",g.style.opacity="1")}),setTimeout(()=>{[l,d].forEach(g=>{g&&(g.style.opacity="0")}),setTimeout(()=>{var g;(g=a.value)==null||g.removeLayer(t)},1e3)},1500)}catch(t){console.error(t),L({message:"Failed to set default map position",variant:"error"})}},mt=async()=>{if(!b.value||!a.value)return;K.value&&(a.value.removeLayer(K.value),K.value=void 0),K.value=m.marker(b.value,{icon:m.divIcon({className:"marker-icon",iconSize:[24,24],iconAnchor:[12,12]})}).addTo(a.value);const e=m.tooltip({content:'<i class="mdi mdi-crosshairs-gps border-[1px] rounded-full text-[18px] px-[2px] pt-[1px] "></i>',permanent:!0,direction:"center",className:"waypoint-tooltip",opacity:1});if(K.value.bindTooltip(e),b.value){const g=s.coordinates.altitude??0,_=b.value[0],ie=b.value[1];try{await s.goTo(0,0,0,0,_,ie,g)}catch(ve){L({message:`GoTo request failed: ${ve.message}`,variant:"error"})}}},ce=async e=>{switch(e){case"goto":{mt();break}case"set-default-map-position":vt();break;case"place-poi":b.value&&G.value?G.value.openDialog(b.value):b.value?G.value||(L({message:"POI Manager (map widget) is not available.",variant:"error"}),console.error("Cannot open POI dialog, POI Manager (map widget) ref is not set.")):(L({message:"Cannot place Point of Interest without map coordinates.",variant:"error"}),console.error("Cannot open POI dialog without click coordinates for new POI"));break;case"set-home-waypoint":b.value&&be(b.value);break;default:console.warn("Unknown menu option selected:",e)}B.value=!1},ue=()=>{B.value=!1,a.value!==void 0&&Ae.value!==void 0&&a.value.removeLayer(Ae.value)},Pe=e=>{e.key==="Escape"&&ue()},xe=e=>{e.forEach((t,i)=>{i===0?(y.value=t.coordinates,be(t.coordinates)):X.value.push(t)})},de=r(!1),Be=r(0),De=async()=>{de.value=!0,_e();const e=async t=>{Be.value=t};try{const t=await s.fetchMission(e);xe(t),L({variant:"success",message:"Mission download succeeded!",duration:3e3})}catch(t){J({variant:"error",title:"Mission download failed",message:t,timer:5e3})}finally{de.value=!1}},be=async e=>{const t=[e[0],e[1]];y.value=t,await s.setHomeWaypoint(t,0),B.value&&(B.value=!1)},He=async()=>{try{await s.startMission()}catch{L({message:"Failed to start mission.",variant:"error"})}},pt=async()=>{if(v.showChecklistBeforeArm){o.value=!0;return}He()},oe=Gt(),ft=I(()=>`${Math.max(-oe.widgetClearanceForVisibleArea(E.value).bottom,0)}px`),ze=I(()=>`${Math.max(-oe.widgetClearanceForVisibleArea(E.value).top,0)}px`),gt=I(()=>s.isVehicleOnline?"Download the mission that is stored in the vehicle.":"Cannot download mission (vehicle offline)."),ht=I(()=>s.isVehicleOnline?"Execute the mission that is stored in the vehicle.":"Cannot execute mission (vehicle offline)."),yt=I(()=>y.value===void 0?"Cannot center map on home (home position undefined).":Y.value===k.HOME?"Tracking home position. Click to stop tracking.":"Click once to center on home or twice to track it."),xt=I(()=>s.isVehicleOnline?V.value===void 0?"Cannot center map on vehicle (vehicle position undefined).":Y.value===k.VEHICLE?"Tracking vehicle position. Click to stop tracking.":"Click once to center on vehicle or twice to track it.":"Cannot center map on vehicle (vehicle offline)."),Ne=e=>({html:`
    <div class="poi-marker-container">
      <div class="poi-marker-background" style="background-color: ${e.color}80;"></div>
      <i class="v-icon notranslate mdi ${e.icon}" style="color: rgba(255, 255, 255, 0.7); position: relative; z-index: 2;"></i>
    </div>
  `,className:"poi-marker-icon-widget",iconSize:[32,32],iconAnchor:[16,32]}),Re=e=>{if(!a.value||!a.value.getContainer())return;const t=m.divIcon(Ne(e)),i=m.marker(e.coordinates,{icon:t,draggable:!0}).addTo(a.value),l=`
    <strong>${e.name}</strong><br>
    ${e.description?e.description+"<br>":""}
    Lat: ${e.coordinates[0].toFixed(8)}, Lng: ${e.coordinates[1].toFixed(8)}
  `,d={permanent:!1,direction:"top",offset:[0,-40],className:"poi-tooltip-widget"};i.bindTooltip(l,d),i.on("drag",g=>{var ve;const _=g.target.getLatLng(),ie=`
      <strong>${e.name}</strong><br>
      ${e.description?e.description+"<br>":""}
      Lat: ${_.lat.toFixed(8)}, Lng: ${_.lng.toFixed(8)}
    `;(ve=i.getTooltip())==null||ve.setContent(ie)}),i.on("dragend",g=>{const _=g.target.getLatLng();v.movePointOfInterest(e.id,[_.lat,_.lng])}),i.on("click",g=>{if(m.DomEvent.stopPropagation(g),G.value){const _=v.pointsOfInterest.find(ie=>ie.id===e.id);_?G.value.openDialog(void 0,_):console.warn("POI not found in store:",e.id)}}),S.value[e.id]=i},Ue=e=>{var l;if(!a.value||!a.value.getContainer()||!S.value[e.id])return;const t=S.value[e.id];t.setLatLng(e.coordinates),t.setIcon(m.divIcon(Ne(e)));const i=`
    <strong>${e.name}</strong><br>
    ${e.description?e.description+"<br>":""}
    Lat: ${e.coordinates[0].toFixed(8)}, Lng: ${e.coordinates[1].toFixed(8)}
  `;(l=t.getTooltip())==null||l.setContent(i)},bt=e=>{!a.value||!S.value[e]||(S.value[e].remove(),delete S.value[e])};return h(()=>v.pointsOfInterest,async e=>{if((!a.value||!a.value.getContainer())&&(await ke(),!a.value||!a.value.getContainer())){console.warn("Map.vue: POI watcher - map not ready after nextTick.");return}const t=new Set(e.map(i=>i.id));Object.keys(S.value).forEach(i=>{t.has(i)||bt(i)}),e.forEach(i=>{S.value[i.id]?Ue(i):Re(i)})},{deep:!0,immediate:!0}),h(a,e=>{e&&e.getContainer()&&v.pointsOfInterest.forEach(t=>{S.value[t.id]?Ue(t):Re(t)})},{immediate:!0}),(e,t)=>{const i=jt("contextmenu");return w(),W(ot,null,[Yt((w(),W("div",{ref_key:"mapBase",ref:j,class:we(["page-base",n(oe).editingMode?"pointer-events-none":"pointer-events-auto"])},[U("div",{id:Q.value,ref_key:"map",ref:a,class:"map"},[c(pe,{location:"top",text:yt.value},{activator:p(({props:l})=>[O.value?(w(),N(F,me({key:0},l,{class:["absolute right-[166px] m-3 bottom-button bg-slate-50 text-[14px]",y.value?"":"active-events-on-disabled"],color:Y.value==n(k).HOME?"red":"",elevation:"2",style:{"z-index":"1002","border-radius":"0px"},icon:"mdi-home-search",size:"x-small",disabled:!y.value,onClick:t[0]||(t[0]=q(d=>n(T).goToTarget(n(k).HOME,!0),["stop"])),onDblclick:t[1]||(t[1]=q(d=>n(T).follow(n(k).HOME),["stop"]))}),null,16,["class","color","disabled"])):z("",!0)]),_:1},8,["text"]),c(pe,{location:"top",text:xt.value},{activator:p(({props:l})=>[O.value?(w(),N(F,me({key:0},l,{class:["absolute m-3 bottom-button right-[124px] bg-slate-50 text-[14px]",V.value?"":"active-events-on-disabled"],color:Y.value==n(k).VEHICLE?"red":"",elevation:"2",style:{"z-index":"1002","border-radius":"0px"},icon:"mdi-airplane-marker",size:"x-small",disabled:!V.value,onClick:t[2]||(t[2]=q(d=>n(T).goToTarget(n(k).VEHICLE,!0),["stop"])),onDblclick:t[3]||(t[3]=q(d=>n(T).follow(n(k).VEHICLE),["stop"]))}),null,16,["class","color","disabled"])):z("",!0)]),_:1},8,["text"]),c(pe,{location:"top",text:gt.value},{activator:p(({props:l})=>[O.value?(w(),N(F,me({key:0},l,{class:["absolute m-3 bottom-button right-[82px] bg-slate-50 text-[14px]",n(s).isVehicleOnline?"":"active-events-on-disabled"],disabled:!n(s).isVehicleOnline,elevation:"2",style:{"z-index":"1002","border-radius":"0px"},icon:"mdi-download",size:"x-small",onClick:q(De,["stop"])}),null,16,["class","disabled"])):z("",!0)]),_:1},8,["text"]),c(pe,{location:"top",text:ht.value},{activator:p(({props:l})=>[O.value?(w(),N(F,me({key:0},l,{class:["absolute mb-3 ml-1 bottom-button right-[52px] bg-slate-50 text-[14px]",n(s).isVehicleOnline?"":"active-events-on-disabled"],disabled:!n(s).isVehicleOnline,elevation:"2",style:{"z-index":"1002","border-radius":"0px"},icon:"mdi-play",size:"x-small",onClick:q(pt,["stop"])}),null,16,["class","disabled"])):z("",!0)]),_:1},8,["text"])],8,sa)],2)),[[i,ct]]),c(Kt,{ref_key:"contextMenuRef",ref:ee,visible:B.value,width:"260px","menu-items":dt,onClose:ue},null,8,["visible","menu-items"]),c(lt,{modelValue:n(oe).widgetManagerVars(n(E).hash).configMenuOpen,"onUpdate:modelValue":t[5]||(t[5]=l=>n(oe).widgetManagerVars(n(E).hash).configMenuOpen=l),width:"auto"},{default:p(()=>[c(et,{class:"pa-2",style:se(n(C).globalGlassMenuStyles)},{default:p(()=>[c(tt,{class:"text-center"},{default:p(()=>t[7]||(t[7]=[H("Map widget settings")])),_:1,__:[7]}),c(at,null,{default:p(()=>[c(qt,{modelValue:n(E).options.showVehiclePath,"onUpdate:modelValue":t[4]||(t[4]=l=>n(E).options.showVehiclePath=l),class:"my-1",label:"Show vehicle path",color:n(E).options.showVehiclePath?"white":void 0,"hide-details":""},null,8,["modelValue","color"])]),_:1})]),_:1},8,["style"])]),_:1},8,["modelValue"]),de.value?(w(),N(Jt,{key:0,"model-value":Be.value,height:"10",absolute:"",bottom:"",color:"white",style:se(`top: ${ze.value}`)},null,8,["model-value","style"])):z("",!0),de.value?(w(),W("p",{key:1,style:se({top:ze.value}),class:"absolute left-[7px] mt-4 flex text-md font-bold text-white z-30 drop-shadow-md"}," Loading mission... ",4)):z("",!0),c(Qt,{ref_key:"poiManagerMapWidgetRef",ref:G},null,512),c(la,{"model-value":o.value,onConfirmed:He,"onUpdate:modelValue":t[6]||(t[6]=l=>o.value=l)},null,8,["model-value"]),u.value?(w(),W("div",{key:2,class:"absolute top-14 left-2 flex justify-start items-center text-white text-md py-2 px-4 rounded-lg",style:se(n(C).globalGlassMenuStyles)},[U("p",null,"Saving offline map content: "+it(P.value?Math.round(x.value/P.value*100):0)+"%",1)],4)):z("",!0)],64)}}}),ca=st(na,[["__scopeId","data-v-0f4a805c"]]);export{ca as default};
