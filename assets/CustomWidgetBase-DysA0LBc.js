import{c as pe,J as we,K as he,aF as be,I as xe,r as f,k as B,au as ye,w as ke,L as Ve,o as Me,l as d,m,n as u,G as o,N as r,Q as V,ae as q,q as D,ar as Q,aG as Ce,t as Y,s as a,v as M,H as N,a5 as $,a2 as Fe,aH as We,aI as j,aJ as R,aK as Be,aL as Se,x as p,O as T,F as S,p as E,aM as Z,aN as ee,V as Le,P as Ee,U as te,aB as ae,aO as Oe,al as ze,aA as Ie,aP as Ae,_ as Ue}from"./index-B2cQqR6w.js";const De=["width","height"],Ne={class:"flex flex-col justify-between h-full pa-2 cursor-pointer"},$e={class:"flex justify-between w-full"},je={key:0},Re={key:0},Te={class:"flex"},He={key:0,class:"flex rotate-[270deg] justify-center whitespace-nowrap"},_e={class:"flex justify-center h-full px-3 pt-2 gap-x-2"},Ge=["data-widget-hash"],Ke=["data-widget-hash"],Xe={class:"flex flex-col justify-start items-start gap-x-4 mt-3 w-full"},Je=pe({__name:"CustomWidgetBase",props:{widget:{}},setup(se){const n=we(),le=he(),{showSnackbar:O}=be(),w=se,i=xe(w).widget,g=f(w.widget),z=f(new Map),H=f(!1),_=f("justify-center"),ne=f(!1),I=f(!1),C=f(w.widget.name),x=f(null),L=f(w.widget.options.leftColumnWidth||50),G=f(!1),F=f(null),c=f(!1),y=f("right"),A=()=>{if(F.value){const s=F.value.getBoundingClientRect(),e=window.innerWidth;s.left+s.width/2<e/2?y.value="left":y.value="right"}},oe=B(()=>y.value==="left"?c.value?"mdi-chevron-right":"mdi-chevron-left":c.value?"mdi-chevron-left":"mdi-chevron-right"),ie=()=>{C.value=w.widget.name,I.value=!0,Ie(()=>{x.value&&(x.value.focus(),x.value.select())})},K=()=>{I.value=!1,g.value&&C.value!==g.value.name&&(g.value.name=C.value)},de=s=>{var l;const e=(l=s.target.files)==null?void 0:l[0];if(!e){O({variant:"error",message:"No file selected.",duration:3e3});return}const t=new FileReader;t.onload=k=>{var b;try{const v=JSON.parse((b=k.target)==null?void 0:b.result),W=g.value.hash;n.loadWidgetFromFile(W,v)}catch{O({variant:"error",message:"Invalid widget file format.",duration:3e3})}},t.readAsText(e)},U=s=>{if(ne.value=!1,s==="options")n.widgetManagerVars(g.value.hash).configMenuOpen=!0;else if(s==="save")n.downloadWidgetAsBrw(g.value);else if(s==="load"){const e=document.createElement("input");e.type="file",e.accept=".brw",e.addEventListener("change",t=>{de(t)}),e.click()}},re=s=>{if(!n.editingMode)return;const e=s.clientX,t=L.value;G.value=!0;const l=b=>{if(!F.value)return;const v=F.value.offsetWidth,W=t+(b.clientX-e)/v*100;L.value=Math.max(10,Math.min(90,W))},k=()=>{G.value=!1,document.removeEventListener("mousemove",l),document.removeEventListener("mouseup",k)};document.addEventListener("mousemove",l),document.addEventListener("mouseup",k)},ue=B(()=>g.value.options.elementContainers.filter(s=>s.name.includes("left"))),me=B(()=>g.value.options.elementContainers.filter(s=>s.name.includes("right"))),ge=B(()=>Math.round(i.value.options.backgroundOpacity*255).toString(16)),ve=()=>{n.allowMovingAndResizing(g.value.hash,!0),window.addEventListener("mouseup",h),window.addEventListener("dragend",h)},h=()=>{A(),n.allowMovingAndResizing(g.value.hash,!1),window.removeEventListener("mouseup",h),window.removeEventListener("dragend",h)},X=(s,e)=>{const t=g.value.options.elementContainers.find(v=>v.name===e);if(!t)return;const l=t.elements.map(v=>v.hash),k=z.value.get(e)||[],b=l.find(v=>!k.includes(v));if(b){const v=t.elements.find(W=>W.hash===b);v&&s.pullMode==="clone"&&(v.hash=Ae(),n.miniWidgetManagerVars(v.hash).configMenuOpen=!0),z.value.set(e,l)}},{width:J}=ye(),P=B(()=>({width:g.value.size.width*J.value,height:g.value.size.height*J.value})),fe=f(null);ke(()=>n.editingMode,s=>{s===!0&&(h(),c.value=!1)});const ce=()=>{try{const s=n.editWidgetByHash(w.widget.hash);s&&(g.value=s)}catch{O({variant:"warning",message:"Error reading widget file.",duration:1e3})}};return Ve(()=>{w.widget.options.elementContainers.forEach(s=>{z.value.set(s.name,s.elements.map(e=>e.hash))})}),Me(()=>{A(),window.addEventListener("resize",A),fe.value=document.querySelector(".main"),ce(),h()}),(s,e)=>(d(),m(S,null,[u("div",{ref_key:"widgetBase",ref:F,class:p(["h-full rounded-lg overflow-hidden",[c.value?"w-[40px]":"w-full",c.value&&y.value==="left"?"ml-0 mr-auto":"",c.value&&y.value==="right"?"mr-0 ml-auto":""]]),width:P.value.width,height:P.value.height,style:T([a(le).globalGlassMenuStyles,{backgroundColor:`${a(i).options.backgroundColor+ge.value}`,backdropFilter:`blur(${a(i).options.backgroundBlur}px)`}])},[u("div",Ne,[u("div",$e,[o(q,{class:"cursor-grab opacity-40",onMousedown:ve,onMouseup:h},{default:r(()=>e[11]||(e[11]=[V(" mdi-drag ")])),_:1}),c.value?M("",!0):(d(),m("div",je,[I.value?(d(),m("div",Re,[D(u("input",{ref_key:"nameInput",ref:x,"onUpdate:modelValue":e[0]||(e[0]=t=>C.value=t),class:"border-b border-gray-400",onBlur:K,onKeyup:Ce(K,["enter"])},null,544),[[Q,C.value]])])):(d(),m("p",{key:1,onDblclick:ie},Y(a(i).name),33))])),u("div",Te,[a(n).editingMode?(d(),N(Be,{key:0,theme:"dark"},{activator:r(({props:t})=>[o($,Fe({size:"20",icon:"mdi-dots-vertical",variant:"text"},t),null,16)]),default:r(()=>[o(We,null,{default:r(()=>[o(j,{onClick:e[1]||(e[1]=t=>U("options"))},{default:r(()=>[o(R,null,{default:r(()=>e[12]||(e[12]=[V("Options")])),_:1})]),_:1}),o(j,{onClick:e[2]||(e[2]=t=>U("save"))},{default:r(()=>[o(R,null,{default:r(()=>e[13]||(e[13]=[V("Save")])),_:1})]),_:1}),o(j,{onClick:e[3]||(e[3]=t=>U("load"))},{default:r(()=>[o(R,null,{default:r(()=>e[14]||(e[14]=[V("Load")])),_:1})]),_:1})]),_:1})]),_:1})):M("",!0)])]),c.value?(d(),m("div",He,Y(a(i).name),1)):M("",!0),D(u("div",_e,[u("div",{class:p(["flex flex-col justify-center border-[#FFFFFF33] border-dashed rounded-md",[a(n).editingMode?"border-[1px]":"border-0"]]),style:T({width:a(i).options.columns>1?`${L.value}%`:"100%"})},[(d(!0),m(S,null,E(ue.value,t=>(d(),m("div",{key:t.name,class:"w-full h-full"},[o(a(ee),{modelValue:t.elements,"onUpdate:modelValue":l=>t.elements=l,disabled:!a(n).editingMode,animation:150,group:"customWidgetsGroup",class:p(["flex items-center w-full h-full gap-2 px-2",[H.value?"flex-wrap":"",_.value]]),onAdd:l=>X(l,t.name)},{default:r(()=>[(d(!0),m(S,null,E(t.elements,l=>(d(),m("div",{key:l.hash,"data-widget-hash":l.hash,class:p(["rounded-md w-full",{"cursor-grab":a(n).editingMode,"bg-slate-400":a(n).miniWidgetManagerVars(l.hash).highlighted}])},[o(Z,{element:l},null,8,["element"])],10,Ge))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","disabled","class","onAdd"])]))),128))],6),a(i).options.columns>1&&a(n).editingMode?(d(),m("div",{key:0,class:"cursor-col-resize w-1 bg-[#FFFFFF22] relative",onMousedown:re},e[15]||(e[15]=[u("div",{class:"absolute inset-y-0 -left-1 -right-1"},null,-1)]),32)):M("",!0),a(i).options.columns>1?(d(),m("div",{key:1,class:p(["flex flex-col justify-center border-[#FFFFFF33] border-dashed rounded-md",[a(n).editingMode?"border-[1px]":"border-0"]]),style:T({width:`${100-L.value}%`})},[(d(!0),m(S,null,E(me.value,t=>(d(),m("div",{key:t.name,class:"w-full h-full"},[o(a(ee),{modelValue:t.elements,"onUpdate:modelValue":l=>t.elements=l,disabled:!a(n).editingMode,animation:150,group:"customWidgetsGroup",class:p(["flex items-center w-full h-full gap-2 px-2",[H.value?"flex-wrap":"",_.value]]),onAdd:l=>X(l,t.name)},{default:r(()=>[(d(!0),m(S,null,E(t.elements,l=>(d(),m("div",{key:l.hash,"data-widget-hash":l.hash,class:p(["rounded-md w-full",{"cursor-grab":a(n).editingMode,"bg-slate-400":a(n).miniWidgetManagerVars(l.hash).highlighted}])},[o(Z,{element:l},null,8,["element"])],10,Ke))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","disabled","class","onAdd"])]))),128))],6)):M("",!0)],512),[[Se,!c.value]]),e[16]||(e[16]=u("div",null,null,-1)),a(n).editingMode?M("",!0):(d(),N($,{key:1,class:p(["fixed bottom-[2px]",y.value==="left"?"left-[2px]":"right-[2px]"]),icon:oe.value,variant:"text",size:"36",onClick:e[4]||(e[4]=t=>c.value=!c.value)},null,8,["class","icon"]))])],14,De),(d(),N(ze,{to:"body"},[o(Oe,{"is-visible":a(n).widgetManagerVars(a(i).hash).configMenuOpen},{default:r(()=>[o(Le,{class:"px-8 pb-6 pt-2 rounded-lg w-[400px] bg-transparent"},{default:r(()=>[o(Ee,{class:"text-center -mt-1"},{default:r(()=>e[17]||(e[17]=[V("Custom Widget options")])),_:1}),o($,{class:"absolute top-3 right-0 text-lg rounded-full",variant:"text",size:"small",onClick:e[5]||(e[5]=t=>a(n).widgetManagerVars(a(i).hash).configMenuOpen=!1)},{default:r(()=>[o(q,null,{default:r(()=>e[18]||(e[18]=[V("mdi-close")])),_:1})]),_:1}),u("div",Xe,[e[19]||(e[19]=u("p",{class:"text-start"},"Name:",-1)),o(te,{ref_key:"nameInput",ref:x,modelValue:a(i).name,"onUpdate:modelValue":e[6]||(e[6]=t=>a(i).name=t),density:"compact",class:"w-3/4"},null,8,["modelValue"]),e[20]||(e[20]=u("p",{class:"text-start"},"Columns:",-1)),o(te,{ref_key:"nameInput",ref:x,modelValue:a(i).options.columns,"onUpdate:modelValue":e[7]||(e[7]=t=>a(i).options.columns=t),min:"1",max:"2",type:"number",density:"compact",class:"w-1/4"},null,8,["modelValue"]),e[21]||(e[21]=u("p",{class:"mt-1"},"Background color",-1)),D(u("input",{"onUpdate:modelValue":e[8]||(e[8]=t=>a(i).options.backgroundColor=t),type:"color",class:"p-0 w-20 mr-4"},null,512),[[Q,a(i).options.backgroundColor]]),e[22]||(e[22]=u("p",{class:"mt-3"},"Background opacity:",-1)),o(ae,{modelValue:a(i).options.backgroundOpacity,"onUpdate:modelValue":e[9]||(e[9]=t=>a(i).options.backgroundOpacity=t),min:"0",max:"1",color:"white","thumb-label":"",width:"250"},null,8,["modelValue"]),e[23]||(e[23]=u("p",{class:"mt-3"},"Background blur:",-1)),o(ae,{modelValue:a(i).options.backgroundBlur,"onUpdate:modelValue":e[10]||(e[10]=t=>a(i).options.backgroundBlur=t),min:"0",max:"100",color:"white","thumb-label":"",width:"250"},null,8,["modelValue"])])]),_:1})]),_:1},8,["is-visible"])]))],64))}}),qe=Ue(Je,[["__scopeId","data-v-373dd92b"]]);export{qe as default};
