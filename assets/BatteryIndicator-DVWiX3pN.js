import{c as z,J as G,K as R,u as q,y as E,L as H,r,k as c,w as P,M as J,N as K,h as L,l as V,m as y,G as Q,T as X,n as l,v as U,t as x,F as S,H as n,O as m,V as Y,P as Z,q as a,Q as ee,R as F,S as te,U as T,W as k,X as le,Y as ae,Z as oe}from"./index-C1SJwrNN.js";const se={class:"flex items-center w-[5.5rem] h-12 text-white justify-center"},ne={class:"flex flex-col w-[4rem] select-none text-sm font-semibold leading-4 text-end"},re={class:"w-full items-center"},ue={class:"font-mono"},ie={class:"w-full"},de={class:"font-mono"},pe={class:"font-mono"},ve={class:"text-red-500 text-center text-sm w-[full]"},ge={class:"flex items-center"},me={class:"flex w-full justify-end my-0"},p=500,ce=z({__name:"BatteryIndicator",props:{miniWidget:{}},setup(O){const{showDialog:N}=G(),t=R(O).miniWidget,W={showCurrent:!0,showPower:!0,toggleInterval:1e3},o=q(),b=E(),j=H(),f=r(!0),v=r(void 0),w=r(""),h=r(void 0),i=r(t.value.options.toggleInterval??W.toggleInterval),g=r(t.value.options.warningVoltage!==void 0),C=r(t.value.options.warningVoltage??0),d=r(null),I=r(!1),M=r(!1),D=c(()=>{var u;return((u=o==null?void 0:o.powerSupply)==null?void 0:u.voltage)===void 0?"--":Math.abs(o.powerSupply.voltage)>=100?o.powerSupply.voltage.toFixed(0):o.powerSupply.voltage.toFixed(1)}),A=c(()=>{var u;return((u=o==null?void 0:o.powerSupply)==null?void 0:u.current)===void 0?"--":Math.abs(o.powerSupply.current)>=100?o.powerSupply.current.toFixed(0):o.powerSupply.current.toFixed(1)}),_=c(()=>o.instantaneousWatts!==void 0?o.instantaneousWatts.toFixed(1):"--"),$=c(()=>"mdi-battery"),B=()=>{(v.value||h.value)&&(clearInterval(v.value),clearTimeout(h.value)),i.value<p?(t.value.options.toggleInterval=p,w.value=`Interval must be at least ${p}ms.`):t.value.options.toggleInterval=i.value,!t.value.options.showCurrent&&!t.value.options.showPower&&(t.value.options.showCurrent=!0,t.value.options.showPower=!0,w.value="At least one of the options must be enabled."),t.value.options.showCurrent&&t.value.options.showPower?v.value=setInterval(()=>{f.value=!f.value},t.value.options.toggleInterval):f.value=t.value.options.showCurrent,h.value=setTimeout(()=>{w.value="",i.value<p&&(i.value=p)},5e3)};return P([()=>t.value.options,i],B,{deep:!0}),P(()=>D.value,u=>{const e=Number(u);if(!(g.value&&C.value&&e<C.value&&!M.value)){d.value&&(clearTimeout(d.value),d.value=null);return}!d.value&&!I.value&&(d.value=setTimeout(()=>{I.value=!0,N({title:"Battery Warning",message:`Voltage is below ${C.value}V!`,variant:"error"}).finally(()=>{I.value=!1,M.value=!0}),d.value=null},5e3))}),J(()=>{t.value.options=Object.assign({},W,t.value.options),B(),K.registerUsage("Instantaneous Watts")}),L(()=>{v.value===void 0&&clearInterval(v.value)}),(u,e)=>(V(),y(S,null,[Q((V(),y("div",se,[l("span",{class:U(["relative w-[1.5rem] mdi battery-icon",[$.value]])},e[7]||(e[7]=[l("span",{class:"absolute text-sm text-yellow-400 -bottom-[2px] -right-[7px] mdi mdi-alert-circle"},null,-1)]),2),l("div",ne,[l("div",re,[l("span",ue,x(D.value),1),e[8]||(e[8]=l("span",null," V",-1))]),l("div",ie,[f.value?(V(),y(S,{key:0},[l("span",de,x(A.value),1),e[9]||(e[9]=l("span",null," A",-1))],64)):(V(),y(S,{key:1},[l("span",pe,x(_.value),1),e[10]||(e[10]=l("span",null," W",-1))],64))])])])),[[X,"Battery information"]]),n(oe,{modelValue:a(b).miniWidgetManagerVars(a(t).hash).configMenuOpen,"onUpdate:modelValue":e[6]||(e[6]=s=>a(b).miniWidgetManagerVars(a(t).hash).configMenuOpen=s),width:"auto"},{default:m(()=>[n(Y,{class:"pa-4 pb-3 text-white w-[20rem]",style:Z([{"border-radius":"15px"},a(j).globalGlassMenuStyles])},{default:m(()=>[n(ee,{class:"text-center"},{default:m(()=>e[11]||(e[11]=[F("Battery Indicator Config")])),_:1}),n(te,{class:"flex flex-col gap-y-2"},{default:m(()=>[n(T,{modelValue:a(t).options.showCurrent,"onUpdate:modelValue":e[0]||(e[0]=s=>a(t).options.showCurrent=s),label:"Show Current","hide-details":""},null,8,["modelValue"]),n(T,{modelValue:a(t).options.showPower,"onUpdate:modelValue":e[1]||(e[1]=s=>a(t).options.showPower=s),label:"Show Power","hide-details":"",class:"mt-[-15px]"},null,8,["modelValue"]),n(k,{modelValue:i.value,"onUpdate:modelValue":e[2]||(e[2]=s=>i.value=s),modelModifiers:{number:!0},label:"Toggle Interval (ms)",type:"number",min:p,step:"100",density:"compact",variant:"outlined",disabled:!a(t).options.showCurrent||!a(t).options.showPower},null,8,["modelValue","disabled"]),l("p",ve,x(w.value),1),n(T,{modelValue:g.value,"onUpdate:modelValue":e[3]||(e[3]=s=>g.value=s),"hide-details":"",label:"Warn if battery voltage drops under:"},null,8,["modelValue"]),l("div",ge,[n(k,{modelValue:a(t).options.warningVoltage,"onUpdate:modelValue":e[4]||(e[4]=s=>a(t).options.warningVoltage=s),variant:"outlined","hide-details":"",density:"compact",type:"number",step:"0.1",width:"30px",disabled:!g.value,class:U({"opacity-50":!g.value})},null,8,["modelValue","disabled","class"]),e[12]||(e[12]=l("p",{class:"w-8 text-center"},"V",-1))])]),_:1}),n(le,{class:"w-4/5 self-center mb-2"}),l("div",me,[n(ae,{variant:"text",onClick:e[5]||(e[5]=s=>a(b).miniWidgetManagerVars(a(t).hash).configMenuOpen=!1)},{default:m(()=>e[13]||(e[13]=[F("Close")])),_:1})])]),_:1},8,["style"])]),_:1},8,["modelValue"])],64))}});export{ce as default};
