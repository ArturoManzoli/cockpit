import{c as $,J as z,K as G,u as R,y as q,L as E,r as i,k as w,w as B,M as H,N as J,h as K,l as x,m as V,G as L,T as Q,n as l,v as P,t as y,H as n,O as g,V as X,P as Y,q as a,Q as Z,R as U,S as ee,U as S,W as _,X as te,Y as le,Z as ae,F as se}from"./index-9MVlYUXS.js";const oe={class:"flex items-center w-[95px] h-12 text-white justify-center"},ne={class:"relative right-0 flex flex-col w-[4rem] select-none text-sm font-semibold leading-4 text-end -mr-2"},ie={class:"w-full"},re={class:"flex justify-end gap-x-1 items-center"},ue={class:"font-mono"},de={class:"w-full"},pe={key:0,class:"flex justify-end gap-x-1 items-center"},ve={class:"font-mono mt-[2px]"},me={key:1,class:"flex justify-end gap-x-1 items-center text-yellow-100"},ge={class:"font-mono mt-[2px]"},fe={class:"text-red-500 text-center text-sm w-[full]"},ce={class:"flex items-center"},we={class:"flex w-full justify-end my-0"},p=500,ye=$({__name:"BatteryIndicator",props:{miniWidget:{}},setup(F){const{showDialog:k}=z(),t=G(F).miniWidget,T={showCurrent:!0,showPower:!0,toggleInterval:1e3},s=R(),h=q(),O=E(),f=i(!0),v=i(void 0),c=i(""),b=i(void 0),u=i(t.value.options.toggleInterval??T.toggleInterval),m=i(t.value.options.warningVoltage!==void 0),C=i(t.value.options.warningVoltage??0),d=i(null),I=i(!1),W=i(!1),M=w(()=>{var r;return((r=s==null?void 0:s.powerSupply)==null?void 0:r.voltage)===void 0?"--":Math.abs(s.powerSupply.voltage)>=100?s.powerSupply.voltage.toFixed(0):s.powerSupply.voltage.toFixed(1)}),j=w(()=>{var r;return((r=s==null?void 0:s.powerSupply)==null?void 0:r.current)===void 0?"--":Math.abs(s.powerSupply.current)>=100?s.powerSupply.current.toFixed(0):s.powerSupply.current.toFixed(1)}),N=w(()=>s.instantaneousWatts!==void 0?s.instantaneousWatts.toFixed(1):"--"),A=w(()=>"mdi-battery"),D=()=>{(v.value||b.value)&&(clearInterval(v.value),clearTimeout(b.value)),u.value<p?(t.value.options.toggleInterval=p,c.value=`Interval must be at least ${p}ms.`):t.value.options.toggleInterval=u.value,!t.value.options.showCurrent&&!t.value.options.showPower&&(t.value.options.showCurrent=!0,t.value.options.showPower=!0,c.value="At least one of the options must be enabled."),t.value.options.showCurrent&&t.value.options.showPower?v.value=setInterval(()=>{f.value=!f.value},t.value.options.toggleInterval):f.value=t.value.options.showCurrent,b.value=setTimeout(()=>{c.value="",u.value<p&&(u.value=p)},5e3)};return B([()=>t.value.options,u],D,{deep:!0}),B(()=>M.value,r=>{const e=Number(r);if(!(m.value&&C.value&&e<C.value&&!W.value)){d.value&&(clearTimeout(d.value),d.value=null);return}!d.value&&!I.value&&(d.value=setTimeout(()=>{I.value=!0,k({title:"Battery Warning",message:`Voltage is below ${C.value}V!`,variant:"error"}).finally(()=>{I.value=!1,W.value=!0}),d.value=null},5e3))}),H(()=>{t.value.options=Object.assign({},T,t.value.options),D(),J.registerUsage("Instantaneous Watts")}),K(()=>{v.value===void 0&&clearInterval(v.value)}),(r,e)=>(x(),V(se,null,[L((x(),V("div",oe,[l("span",{class:P(["relative w-[1.5rem] mdi battery-icon left-0 mr-3",[A.value]])},e[7]||(e[7]=[l("span",{class:"absolute text-sm text-yellow-400 -bottom-[3px] left-[4px] mdi mdi-alert-circle"},null,-1)]),2),l("div",ne,[l("div",ie,[l("div",re,[l("span",ue,y(M.value),1),e[8]||(e[8]=l("div",{class:"w-[15px] mr-[1px] -ml-[1px]"},"V",-1))])]),l("div",de,[f.value?(x(),V("div",pe,[l("span",ve,y(j.value),1),e[9]||(e[9]=l("div",{class:"w-[15px]"},"A",-1))])):(x(),V("div",me,[l("span",ge,y(N.value),1),e[10]||(e[10]=l("div",{class:"w-[15px]"},"W",-1))]))])])])),[[Q,"Battery information"]]),n(ae,{modelValue:a(h).miniWidgetManagerVars(a(t).hash).configMenuOpen,"onUpdate:modelValue":e[6]||(e[6]=o=>a(h).miniWidgetManagerVars(a(t).hash).configMenuOpen=o),width:"auto"},{default:g(()=>[n(X,{class:"pa-4 pb-3 text-white w-[20rem]",style:Y([{"border-radius":"15px"},a(O).globalGlassMenuStyles])},{default:g(()=>[n(Z,{class:"text-center"},{default:g(()=>e[11]||(e[11]=[U("Battery Indicator Config")])),_:1}),n(ee,{class:"flex flex-col gap-y-2"},{default:g(()=>[n(S,{modelValue:a(t).options.showCurrent,"onUpdate:modelValue":e[0]||(e[0]=o=>a(t).options.showCurrent=o),label:"Show Current","hide-details":""},null,8,["modelValue"]),n(S,{modelValue:a(t).options.showPower,"onUpdate:modelValue":e[1]||(e[1]=o=>a(t).options.showPower=o),label:"Show Power","hide-details":"",class:"mt-[-15px]"},null,8,["modelValue"]),n(_,{modelValue:u.value,"onUpdate:modelValue":e[2]||(e[2]=o=>u.value=o),modelModifiers:{number:!0},label:"Toggle Interval (ms)",type:"number",min:p,step:"100",density:"compact",variant:"outlined",disabled:!a(t).options.showCurrent||!a(t).options.showPower},null,8,["modelValue","disabled"]),l("p",fe,y(c.value),1),n(S,{modelValue:m.value,"onUpdate:modelValue":e[3]||(e[3]=o=>m.value=o),"hide-details":"",label:"Warn if battery voltage drops under:"},null,8,["modelValue"]),l("div",ce,[n(_,{modelValue:a(t).options.warningVoltage,"onUpdate:modelValue":e[4]||(e[4]=o=>a(t).options.warningVoltage=o),variant:"outlined","hide-details":"",density:"compact",type:"number",step:"0.1",width:"30px",disabled:!m.value,class:P({"opacity-50":!m.value})},null,8,["modelValue","disabled","class"]),e[12]||(e[12]=l("p",{class:"w-8 text-center"},"V",-1))])]),_:1}),n(te,{class:"w-4/5 self-center mb-2"}),l("div",we,[n(le,{variant:"text",onClick:e[5]||(e[5]=o=>a(h).miniWidgetManagerVars(a(t).hash).configMenuOpen=!1)},{default:g(()=>e[13]||(e[13]=[U("Close")])),_:1})])]),_:1},8,["style"])]),_:1},8,["modelValue"])],64))}});export{ye as default};
