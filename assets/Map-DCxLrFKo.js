import{c as qe,K as Je,aR as Qe,aY as kt,r,k as I,w as h,bm as be,o as Xe,aZ as L,I as N,m as w,N as p,H as u,V as et,O as le,v as n,P as tt,n as U,ai as F,ag as We,Q as H,R as at,a_ as wt,l as W,F as ot,q as Ct,a$ as Mt,bY as Tt,bo as Vt,x as ke,t as it,S as Ze,s as z,U as Et,bd as It,aN as St,bR as Lt,W as lt,_ as st,bO as Ot,J as _t,aG as Ft,u as $t,M as Ge,Y as je,L as At,bZ as Pt,b_ as c,b$ as Ye,j as Bt,c0 as k,aM as Dt,bi as Ht,c1 as zt,c2 as Nt,c3 as Ke,c4 as Rt,c5 as Ut,c6 as Wt,av as Zt,y as Gt,bF as jt,G as Yt,aj as ve,b5 as q,ay as me,c7 as Kt,aE as qt,c8 as Jt,c9 as Qt}from"./index-BefPss6F.js";const Xt={class:"flex justify-end"},ea={key:0,class:"fixed top-[80px] right-5"},ta={key:1,class:"flex w-full items-center"},aa={class:"flex justify-between w-full py-1 px-2 pt-3"},oa={class:"flex items-center"},ia=qe({__name:"MissionChecklist",props:{modelValue:{type:Boolean}},emits:["update:modelValue","confirmed","dismissed"],setup(pe,{emit:se}){const E=Je(),C=Qe(),J=pe,$=se,s=kt("cockpit-pre-arm-checklist",[]),m=r({}),a=r(""),A=r(null),M=r(!1),y=I(()=>J.modelValue),Q=()=>{const f={};for(const o of s.value??[])f[o.id]=!1;m.value=f},O=I(()=>{if(!C.showChecklistBeforeArm)return!0;const f=s.value??[];return f.length>0&&f.every(o=>m.value[o.id]===!0)});h(()=>y.value,f=>{f?(Q(),be(()=>{var o,d;return(d=(o=A.value)==null?void 0:o.focus)==null?void 0:d.call(o)})):(m.value={},M.value=!1)}),h(()=>s.value,f=>{if(!y.value)return;const o={...m.value},d={};for(const x of f??[])d[x.id]=!0,x.id in o||(o[x.id]=!1);for(const x of Object.keys(o)){const P=Number(x);d[P]||delete o[P]}m.value=o},{deep:!0});const Z=async()=>{var d,x;const f=a.value.trim();if(!f)return;const o={id:Date.now(),text:f};s.value.push(o),y.value&&(m.value[o.id]=!1),a.value="",await be(),(x=(d=A.value)==null?void 0:d.focus)==null||x.call(d)},X=f=>{if(s.value=s.value.filter(o=>o.id!==f),f in m.value){const o={...m.value};delete o[f],m.value=o}},ee=()=>{$("dismissed"),$("update:modelValue",!1)},te=()=>{$("confirmed",!0),$("update:modelValue",!1)};return Xe(()=>{s.value.length===0&&(s.value=[{id:Date.now(),text:"Ensure the vehicle is safe to launch"}]),y.value&&Q()}),h(()=>C.showChecklistBeforeArm,f=>{f||L({message:"Pre-arm checklist disabled. You can re-enable it in Settings → Mission → Enable pre-arm checklist.",variant:"info",duration:5e3})},{immediate:!0}),(f,o)=>(w(),N(lt,{modelValue:y.value,"onUpdate:modelValue":o[4]||(o[4]=d=>y.value=d),"max-width":"600",scrollable:"",persistent:""},{default:p(()=>[u(et,{style:le(n(E).globalGlassMenuStyles),class:"rounded-lg"},{default:p(()=>[u(tt,{class:"text-center relative pt-3"},{default:p(()=>[o[6]||(o[6]=U("h6",{class:"ml-4"},"Warning! Your vehicle is about to be armed",-1)),u(F,{icon:"",variant:"text",color:"white",class:"absolute right-1 top-1","aria-label":"Close",onClick:ee},{default:p(()=>[u(We,null,{default:p(()=>o[5]||(o[5]=[H("mdi-close")])),_:1,__:[5]})]),_:1})]),_:1,__:[6]}),u(at,{class:"mt-[-10px]"},{default:p(()=>[u(wt,{lines:"one",theme:"dark",class:"bg-transparent"},{default:p(()=>[(w(!0),W(ot,null,Ct(n(s),d=>(w(),N(Mt,{key:d.id,theme:"dark"},Tt({prepend:p(()=>[u(Ze,{modelValue:m.value[d.id],"onUpdate:modelValue":x=>m.value[d.id]=x,class:"mt-0","hide-details":"",density:"compact",disabled:!n(C).showChecklistBeforeArm},null,8,["modelValue","onUpdate:modelValue","disabled"])]),default:p(()=>[u(Vt,{class:ke([{"line-through opacity-60":m.value[d.id]},{"opacity-50":!n(C).showChecklistBeforeArm}])},{default:p(()=>[H(it(d.text),1)]),_:2},1032,["class"])]),_:2},[M.value&&n(s).length>1?{name:"append",fn:p(()=>[u(F,{icon:"",variant:"text",disabled:!n(C).showChecklistBeforeArm,onClick:x=>X(d.id)},{default:p(()=>[u(We,null,{default:p(()=>o[7]||(o[7]=[H("mdi-close")])),_:1,__:[7]})]),_:2},1032,["disabled","onClick"])]),key:"0"}:void 0]),1024))),128))]),_:1}),U("div",Xt,[M.value?(w(),W("div",ta,[M.value?(w(),N(Et,{key:0,ref_key:"newItemInput",ref:A,modelValue:a.value,"onUpdate:modelValue":o[1]||(o[1]=d=>a.value=d),disabled:!n(C).showChecklistBeforeArm,variant:"filled",density:"compact",placeholder:"Type an item and press Enter","hide-details":"",class:"ml-6 w-[80%]","append-inner-icon":"mdi-plus",onKeyup:It(Z,["enter"]),"onClick:appendInner":Z},null,8,["modelValue","disabled"])):z("",!0),u(F,{"prepend-icon":"mdi-check",disabled:!n(C).showChecklistBeforeArm,variant:"text",color:"white",size:"small",class:"elevation-1 bg-[#FFFFFF15] hover:bg-[#FFFFFF22] ml-10",onClick:o[2]||(o[2]=()=>{M.value=!1,Z()})},{default:p(()=>o[9]||(o[9]=[H("Done")])),_:1,__:[9]},8,["disabled"])])):(w(),W("div",ea,[u(F,{"prepend-icon":"mdi-format-list-checks",disabled:!n(C).showChecklistBeforeArm,variant:"text",color:"white",size:"small",class:"elevation-1 bg-[#FFFFFF15] hover:bg-[#FFFFFF22]",onClick:o[0]||(o[0]=d=>M.value=!0)},{default:p(()=>o[8]||(o[8]=[H(" Edit Items ")])),_:1,__:[8]},8,["disabled"])]))])]),_:1}),u(St,{class:"flex center w-[80%]",inset:""}),u(Lt,null,{default:p(()=>[U("div",aa,[u(F,{variant:"text",onClick:ee},{default:p(()=>o[10]||(o[10]=[H("Cancel")])),_:1,__:[10]}),U("div",oa,[u(Ze,{"model-value":!n(C).showChecklistBeforeArm,class:"mt-0 scale-[0.8]","hide-details":"",density:"compact","onUpdate:modelValue":o[3]||(o[3]=d=>n(C).showChecklistBeforeArm=!d)},null,8,["model-value"]),o[11]||(o[11]=U("p",{class:"text-xs text-center ml-2"},"Don't show this checklist again",-1))]),u(F,{color:"#ffffff33",class:ke({"opacity-30":!O.value}),variant:"flat",disabled:!O.value,onClick:te},{default:p(()=>o[12]||(o[12]=[H("Go")])),_:1,__:[12]},8,["class","disabled"])])]),_:1})]),_:1},8,["style"])]),_:1},8,["modelValue"]))}}),la=st(ia,[["__scopeId","data-v-b0b8e43a"]]),sa=["id"],na=qe({__name:"Map",props:{widget:{}},setup(pe){var Ue;Ot(e=>({"0dfb047d":ft.value}));const se=pe,E=_t(se).widget,C=Je(),{showDialog:J,closeDialog:$}=Ft(),s=$t(),m=Qe(),a=r(),A=r(m.defaultMapZoom),M=r(m.defaultMapCenter),y=r(),Q=I(()=>`map-${E.value.hash}`),O=r(!1),Z=r(!1),X=r([]),ee=r(),te=r(!1),f=r(!1),o=r(!1),d=r(!1),x=r(0),P=r(0);let we;const Ce=e=>{e.touches.length>1&&(f.value=!0,B.value&&ce(),clearTimeout(we))},Me=e=>{e.touches.length<=1&&(we=window.setTimeout(()=>f.value=!1,300))},G=r(null),S=r({});Ge.registerUsage(je.latitude),Ge.registerUsage(je.longitude),At(()=>{Object.keys(E.value.options).length===0&&(E.value.options={showVehiclePath:!0}),T.enableAutoUpdate()});const Te=c.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:23,maxNativeZoom:19,attribution:"© OpenStreetMap"}),ae=Ye.tileLayerOffline("https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",{maxZoom:23,maxNativeZoom:19,attribution:"© Esri World Imagery"}),Ve=c.tileLayer("https://tiles.openseamap.org/seamark/{z}/{x}/{y}.png",{maxZoom:18,attribution:"© OpenSeaMap contributors"}),Ee=c.tileLayer.wms("https://geoserver.openseamap.org/geoserver/gwc/service/wms",{layers:"gebco2021:gebco_2021",format:"image/png",transparent:!0,version:"1.1.1",attribution:"© GEBCO, OpenSeaMap",tileSize:256,maxZoom:19}),nt={OpenStreetMap:Te,"Esri World Imagery":ae},rt={Seamarks:Ve,"Marine Profile":Ee},j=r(),Ie=Bt(j),Se=c.control.zoom({position:"bottomright"}),Le=c.control.layers(nt,rt);h(O,()=>{a.value!==void 0&&(O.value?(a.value.addControl(Se),a.value.addControl(Le)):(a.value.removeControl(Se),a.value.removeControl(Le)))}),h(Ie,()=>{O.value=Ie.value}),Xe(async()=>{var t,i;(t=j.value)==null||t.addEventListener("touchstart",Ce,{passive:!0}),(i=j.value)==null||i.addEventListener("touchend",Me,{passive:!0}),a.value=c.map(Q.value,{layers:[Te,ae,Ve,Ee],attributionControl:!1}).setView(M.value,A.value),a.value.removeControl(a.value.zoomControl),a.value.on("click",l=>{b.value=[l.latlng.lat,l.latlng.lng]}),a.value.on("moveend",()=>{if(a.value===void 0)return;let{lat:l,lng:v}=a.value.getCenter();l&&v&&(M.value=[l,v])});const e=Ye.savetiles(ae,{saveWhatYouSee:!0,maxZoom:19,alwaysDownload:!1,position:"topright",parallel:20,confirm(l,v){J({variant:"info",message:`Save ${l._tilesforSave.length} tiles for offline use?`,persistent:!1,timer:void 0,maxWidth:"450px",actions:[{text:"Cancel",color:"white",action:$},{text:"Save tiles",color:"white",action:()=>{v(),$()}}]})},confirmRemoval(l,v){J({variant:"warning",message:"Remove all saved tiles for this layer?",persistent:!1,timer:void 0,maxWidth:"450px",actions:[{text:"Cancel",color:"white",action:$},{text:"Remove tiles",color:"white",action:()=>{v(),$(),L({message:"Offline tiles removed",variant:"info",duration:3e3})}}]})},saveText:'<i class="mdi mdi-download" title="Save tiles"></i>',rmText:'<i class="mdi mdi-trash-can" title="Remove tiles"></i>'});a.value&&e.addTo(a.value),ae.on("savestart",l=>{var v;x.value=0,P.value=((v=l._tilesforSave)==null?void 0:v.length)??0,L({message:`Saving ${P.value} tiles...`,variant:"info",duration:2e3}),d.value=!0}),ae.on("loadtileend",()=>{x.value+=1,x.value===P.value&&P.value>0&&(L({message:"Offline tiles saved!",variant:"success",duration:3e3}),d.value=!1)}),a.value.on("dragstart",()=>{te.value=!0}),a.value.on("dragend",()=>{setTimeout(()=>te.value=!1,200)}),a.value.on("zoomend",()=>{var l;B.value=!1,a.value!==void 0&&(A.value=((l=a.value)==null?void 0:l.getZoom())??M.value)}),a.value.on("contextmenu",l=>{b.value=[l.latlng.lat,l.latlng.lng]}),T.enableAutoUpdate(),window.addEventListener("keydown",Ae),V.value?T.goToTarget(k.VEHICLE):T.goToTarget(k.HOME),!s.isVehicleOnline&&m.vehicleMission.length&&ye(m.vehicleMission),Z.value=!0,await fe()});const ct={open:e=>{if(!a.value||f.value||te.value)return;e.preventDefault(),e.stopPropagation();const t=a.value.mouseEventToContainerPoint(e),i=a.value.containerPointToLatLng(t);b.value=[i.lat,i.lng],ee.value.openAt(e),B.value=!0},close:()=>{ce()}},Oe=()=>{var e;(e=a.value)==null||e.eachLayer(t=>{(t instanceof c.Marker||t instanceof c.Polyline&&t.options.color==="#358AC3")&&a.value.removeLayer(t)}),X.value=[],ne.value=void 0,R.value=void 0,K.value=void 0},fe=async()=>{Z.value&&(Oe(),s.isVehicleOnline?await Be():m.vehicleMission.length&&ye(m.vehicleMission))};h(()=>s.isVehicleOnline,()=>{fe()}),h(()=>m.vehicleMissionRevision,()=>{fe()}),Dt(()=>{var e,t;T.disableAutoUpdate(),window.removeEventListener("keydown",Ae),a.value&&(a.value.off("contextmenu"),Object.values(S.value).forEach(i=>i.remove()),S.value={}),(e=j.value)==null||e.removeEventListener("touchstart",Ce),(t=j.value)==null||t.removeEventListener("touchend",Me)}),h(M,(e,t)=>{var i;e.toString()!==t.toString()&&((i=a.value)==null||i.panTo(e))}),h(a,(e,t)=>{a.value!==void 0&&(e==null?void 0:e.options)===void 0&&(a.value=t)}),h(A,(e,t)=>{var i;e!==t&&(B.value=!1,(i=a.value)==null||i.setZoom(A.value))}),h(se.widget,()=>{var e;(e=a.value)==null||e.invalidateSize()});const Y=r(void 0),T=new Pt(e=>Y.value=e,e=>M.value=e);T.setTrackableTarget(k.VEHICLE,()=>V.value),T.setTrackableTarget(k.HOME,()=>y.value);const V=I(()=>s.coordinates.latitude?[s.coordinates.latitude,s.coordinates.longitude]:void 0),ge=I(()=>{var e;return s.attitude.yaw?Ht((e=s.attitude)==null?void 0:e.yaw):0}),_e=I(()=>{const e=s.lastHeartbeat;return e?`${zt(e??0,{includeSeconds:!0})} ago`:"never"}),{history:ut}=Nt(V);(Ue=navigator==null?void 0:navigator.geolocation)==null||Ue.watchPosition(e=>{y.value||(y.value=[e.coords.latitude,e.coords.longitude])},e=>console.error(`Failed to get position: (${e.code}) ${e.message}`),{enableHighAccuracy:!1,timeout:5e3,maximumAge:0});let Fe=!0;h([y,a],async()=>{y.value===M.value||!a.value||!Fe||(T.goToTarget(k.HOME),Fe=!1)});const D=r();h(s.coordinates,()=>{if(!(!a.value||!V.value)){if(D.value===void 0){let e=Rt;s.vehicleType===Ke.MAV_TYPE_SURFACE_BOAT?e=Ut:s.vehicleType===Ke.MAV_TYPE_SUBMARINE&&(e=Wt);const t=c.divIcon({className:"vehicle-marker",html:`<img src="${e}" style="width: 64px; height: 64px;">`,iconSize:[64,64],iconAnchor:[32,32]});D.value=c.marker(V.value,{icon:t});const i=c.tooltip({content:"No data available",className:"waypoint-tooltip",offset:[40,0]});D.value.bindTooltip(i),a.value.addLayer(D.value)}D.value.setLatLng(V.value)}}),h(V,(e,t)=>{Y.value===k.VEHICLE||t!==void 0||T.follow(k.VEHICLE)}),h([V,ge,_e,()=>s.isArmed],()=>{var t,i,l,v,g;if(D.value===void 0)return;(v=D.value.getTooltip())==null||v.setContent(`
    <p>Coordinates: ${(t=V.value)==null?void 0:t[0].toFixed(6)}, ${(i=V.value)==null?void 0:i[1].toFixed(6)}</p>
    <p>Velocity: ${((l=s.velocity.ground)==null?void 0:l.toFixed(2))??"N/A"} m/s</p>
    <p>Heading: ${ge.value.toFixed(2)}°</p>
    <p>${s.isArmed?"Armed":"Disarmed"}</p>
    <p>Last seen: ${_e.value}</p>
  `);const e=(g=D.value.getElement())==null?void 0:g.querySelector("img");e&&(e.style.transform=`rotate(${ge.value}deg)`)});const R=r();h(y,()=>{if(a.value===void 0)return;const e=y.value;if(e!==void 0)if(R.value)R.value.setLatLng(e);else{R.value=c.marker(e,{icon:c.divIcon({className:"marker-icon",iconSize:[24,24],iconAnchor:[12,12]}),draggable:!0});const t=c.tooltip({content:'<i class="mdi mdi-home-map-marker text-[18px] "></i>',permanent:!0,direction:"center",className:"waypoint-tooltip",opacity:1});R.value.bindTooltip(t),R.value.on("dragend",i=>{const v=i.target.getLatLng();xe([v.lat,v.lng])}),a.value.addLayer(R.value)}});const ne=r();h(X,e=>{a.value&&(ne.value||(ne.value=c.polyline([],{color:"#358AC3"}).addTo(a.value)),ne.value.setLatLngs(e.map(t=>t.coordinates)),e.forEach((t,i)=>{var g;const l=c.marker(t.coordinates);l.setIcon(c.divIcon({className:"marker-icon",iconSize:[16,16],iconAnchor:[8,8]}));const v=c.tooltip({content:i.toString(),permanent:!0,direction:"center",className:"waypoint-tooltip",opacity:1});l.bindTooltip(v),(g=a.value)==null||g.addLayer(l)}))},{deep:!0});const he=r();h(ut,e=>{if(a.value===void 0||e===void 0)return;he.value===void 0&&(he.value=c.polyline([],{color:"#ffff00"}).addTo(a.value));const t=e.filter(i=>i.snapshot!==void 0).map(i=>i.snapshot);he.value.setLatLngs(t)});const B=r(!1),b=r(null),$e=r(),dt=Zt([{item:"Set home waypoint",action:()=>re("set-home-waypoint"),icon:"mdi-home-map-marker"},{item:"Place Point of Interest",action:()=>re("place-poi"),icon:"mdi-map-marker-plus"},{item:"GoTo",action:()=>re("goto"),icon:"mdi-crosshairs-gps"},{item:"Set default map position",action:()=>re("set-default-map-position"),icon:"mdi-map-check"}]),K=r(),vt=async()=>{var e;if(!(!a.value||!b.value))try{await m.setDefaultMapPosition(b.value,A.value),L({message:"Default map position set",variant:"success"});const t=c.marker(b.value,{icon:c.divIcon({className:"marker-icon",iconSize:[24,24],iconAnchor:[12,12]})}).addTo(a.value),i=c.tooltip({content:'<i class="mdi mdi-map-check text-[18px] border-[1px] rounded-full px-[2px] py-[1px]"></i>',permanent:!0,direction:"center",className:"waypoint-tooltip",opacity:1});t.bindTooltip(i).openTooltip();const l=t.getElement(),v=(e=t.getTooltip())==null?void 0:e.getElement();[l,v].forEach(g=>{g&&(g.style.transition="opacity 1s",g.style.opacity="1")}),setTimeout(()=>{[l,v].forEach(g=>{g&&(g.style.opacity="0")}),setTimeout(()=>{var g;(g=a.value)==null||g.removeLayer(t)},1e3)},1500)}catch(t){console.error(t),L({message:"Failed to set default map position",variant:"error"})}},mt=async()=>{if(!b.value||!a.value)return;K.value&&(a.value.removeLayer(K.value),K.value=void 0),K.value=c.marker(b.value,{icon:c.divIcon({className:"marker-icon",iconSize:[24,24],iconAnchor:[12,12]})}).addTo(a.value);const e=c.tooltip({content:'<i class="mdi mdi-crosshairs-gps border-[1px] rounded-full text-[18px] px-[2px] pt-[1px] "></i>',permanent:!0,direction:"center",className:"waypoint-tooltip",opacity:1});if(K.value.bindTooltip(e),b.value){const g=s.coordinates.altitude??0,_=b.value[0],ie=b.value[1];try{await s.goTo(0,0,0,0,_,ie,g)}catch(de){L({message:`GoTo request failed: ${de.message}`,variant:"error"})}}},re=async e=>{switch(e){case"goto":{mt();break}case"set-default-map-position":vt();break;case"place-poi":b.value&&G.value?G.value.openDialog(b.value):b.value?G.value||(L({message:"POI Manager (map widget) is not available.",variant:"error"}),console.error("Cannot open POI dialog, POI Manager (map widget) ref is not set.")):(L({message:"Cannot place Point of Interest without map coordinates.",variant:"error"}),console.error("Cannot open POI dialog without click coordinates for new POI"));break;case"set-home-waypoint":b.value&&xe(b.value);break;default:console.warn("Unknown menu option selected:",e)}B.value=!1},ce=()=>{B.value=!1,a.value!==void 0&&$e.value!==void 0&&a.value.removeLayer($e.value)},Ae=e=>{e.key==="Escape"&&ce()},ye=e=>{e.forEach((t,i)=>{i===0?(y.value=t.coordinates,xe(t.coordinates)):X.value.push(t)})},ue=r(!1),Pe=r(0),Be=async()=>{ue.value=!0,Oe();const e=async t=>{Pe.value=t};try{const t=await s.fetchMission(e);ye(t),L({variant:"success",message:"Mission download succeeded!",duration:3e3})}catch(t){J({variant:"error",title:"Mission download failed",message:t,timer:5e3})}finally{ue.value=!1}},xe=async e=>{const t=[e[0],e[1]];y.value=t,await s.setHomeWaypoint(t,0),B.value&&(B.value=!1)},De=async()=>{try{await s.startMission()}catch{L({message:"Failed to start mission.",variant:"error"})}},pt=async()=>{if(m.showChecklistBeforeArm){o.value=!0;return}De()},oe=Gt(),ft=I(()=>`${Math.max(-oe.widgetClearanceForVisibleArea(E.value).bottom,0)}px`),He=I(()=>`${Math.max(-oe.widgetClearanceForVisibleArea(E.value).top,0)}px`),gt=I(()=>s.isVehicleOnline?"Download the mission that is stored in the vehicle.":"Cannot download mission (vehicle offline)."),ht=I(()=>s.isVehicleOnline?"Execute the mission that is stored in the vehicle.":"Cannot execute mission (vehicle offline)."),yt=I(()=>y.value===void 0?"Cannot center map on home (home position undefined).":Y.value===k.HOME?"Tracking home position. Click to stop tracking.":"Click once to center on home or twice to track it."),xt=I(()=>s.isVehicleOnline?V.value===void 0?"Cannot center map on vehicle (vehicle position undefined).":Y.value===k.VEHICLE?"Tracking vehicle position. Click to stop tracking.":"Click once to center on vehicle or twice to track it.":"Cannot center map on vehicle (vehicle offline)."),ze=e=>({html:`
    <div class="poi-marker-container">
      <div class="poi-marker-background" style="background-color: ${e.color}80;"></div>
      <i class="v-icon notranslate mdi ${e.icon}" style="color: rgba(255, 255, 255, 0.7); position: relative; z-index: 2;"></i>
    </div>
  `,className:"poi-marker-icon-widget",iconSize:[32,32],iconAnchor:[16,32]}),Ne=e=>{if(!a.value||!a.value.getContainer())return;const t=c.divIcon(ze(e)),i=c.marker(e.coordinates,{icon:t,draggable:!0}).addTo(a.value),l=`
    <strong>${e.name}</strong><br>
    ${e.description?e.description+"<br>":""}
    Lat: ${e.coordinates[0].toFixed(8)}, Lng: ${e.coordinates[1].toFixed(8)}
  `,v={permanent:!1,direction:"top",offset:[0,-40],className:"poi-tooltip-widget"};i.bindTooltip(l,v),i.on("drag",g=>{var de;const _=g.target.getLatLng(),ie=`
      <strong>${e.name}</strong><br>
      ${e.description?e.description+"<br>":""}
      Lat: ${_.lat.toFixed(8)}, Lng: ${_.lng.toFixed(8)}
    `;(de=i.getTooltip())==null||de.setContent(ie)}),i.on("dragend",g=>{const _=g.target.getLatLng();m.movePointOfInterest(e.id,[_.lat,_.lng])}),i.on("click",g=>{if(c.DomEvent.stopPropagation(g),G.value){const _=m.pointsOfInterest.find(ie=>ie.id===e.id);_?G.value.openDialog(void 0,_):console.warn("POI not found in store:",e.id)}}),S.value[e.id]=i},Re=e=>{var l;if(!a.value||!a.value.getContainer()||!S.value[e.id])return;const t=S.value[e.id];t.setLatLng(e.coordinates),t.setIcon(c.divIcon(ze(e)));const i=`
    <strong>${e.name}</strong><br>
    ${e.description?e.description+"<br>":""}
    Lat: ${e.coordinates[0].toFixed(8)}, Lng: ${e.coordinates[1].toFixed(8)}
  `;(l=t.getTooltip())==null||l.setContent(i)},bt=e=>{!a.value||!S.value[e]||(S.value[e].remove(),delete S.value[e])};return h(()=>m.pointsOfInterest,async e=>{if((!a.value||!a.value.getContainer())&&(await be(),!a.value||!a.value.getContainer())){console.warn("Map.vue: POI watcher - map not ready after nextTick.");return}const t=new Set(e.map(i=>i.id));Object.keys(S.value).forEach(i=>{t.has(i)||bt(i)}),e.forEach(i=>{S.value[i.id]?Re(i):Ne(i)})},{deep:!0,immediate:!0}),h(a,e=>{e&&e.getContainer()&&m.pointsOfInterest.forEach(t=>{S.value[t.id]?Re(t):Ne(t)})},{immediate:!0}),(e,t)=>{const i=jt("contextmenu");return w(),W(ot,null,[Yt((w(),W("div",{ref_key:"mapBase",ref:j,class:ke(["page-base",n(oe).editingMode?"pointer-events-none":"pointer-events-auto"])},[U("div",{id:Q.value,ref_key:"map",ref:a,class:"map"},[u(me,{location:"top",text:yt.value},{activator:p(({props:l})=>[O.value?(w(),N(F,ve({key:0},l,{class:["absolute right-[166px] m-3 bottom-button bg-slate-50 text-[14px]",y.value?"":"active-events-on-disabled"],color:Y.value==n(k).HOME?"red":"",elevation:"2",style:{"z-index":"1002","border-radius":"0px"},icon:"mdi-home-search",size:"x-small",disabled:!y.value,onClick:t[0]||(t[0]=q(v=>n(T).goToTarget(n(k).HOME,!0),["stop"])),onDblclick:t[1]||(t[1]=q(v=>n(T).follow(n(k).HOME),["stop"]))}),null,16,["class","color","disabled"])):z("",!0)]),_:1},8,["text"]),u(me,{location:"top",text:xt.value},{activator:p(({props:l})=>[O.value?(w(),N(F,ve({key:0},l,{class:["absolute m-3 bottom-button right-[124px] bg-slate-50 text-[14px]",V.value?"":"active-events-on-disabled"],color:Y.value==n(k).VEHICLE?"red":"",elevation:"2",style:{"z-index":"1002","border-radius":"0px"},icon:"mdi-airplane-marker",size:"x-small",disabled:!V.value,onClick:t[2]||(t[2]=q(v=>n(T).goToTarget(n(k).VEHICLE,!0),["stop"])),onDblclick:t[3]||(t[3]=q(v=>n(T).follow(n(k).VEHICLE),["stop"]))}),null,16,["class","color","disabled"])):z("",!0)]),_:1},8,["text"]),u(me,{location:"top",text:gt.value},{activator:p(({props:l})=>[O.value?(w(),N(F,ve({key:0},l,{class:["absolute m-3 bottom-button right-[82px] bg-slate-50 text-[14px]",n(s).isVehicleOnline?"":"active-events-on-disabled"],disabled:!n(s).isVehicleOnline,elevation:"2",style:{"z-index":"1002","border-radius":"0px"},icon:"mdi-download",size:"x-small",onClick:q(Be,["stop"])}),null,16,["class","disabled"])):z("",!0)]),_:1},8,["text"]),u(me,{location:"top",text:ht.value},{activator:p(({props:l})=>[O.value?(w(),N(F,ve({key:0},l,{class:["absolute mb-3 ml-1 bottom-button right-[52px] bg-slate-50 text-[14px]",n(s).isVehicleOnline?"":"active-events-on-disabled"],disabled:!n(s).isVehicleOnline,elevation:"2",style:{"z-index":"1002","border-radius":"0px"},icon:"mdi-play",size:"x-small",onClick:q(pt,["stop"])}),null,16,["class","disabled"])):z("",!0)]),_:1},8,["text"])],8,sa)],2)),[[i,ct]]),u(Kt,{ref_key:"contextMenuRef",ref:ee,visible:B.value,width:"260px","menu-items":dt,onClose:ce},null,8,["visible","menu-items"]),u(lt,{modelValue:n(oe).widgetManagerVars(n(E).hash).configMenuOpen,"onUpdate:modelValue":t[5]||(t[5]=l=>n(oe).widgetManagerVars(n(E).hash).configMenuOpen=l),width:"auto"},{default:p(()=>[u(et,{class:"pa-2",style:le(n(C).globalGlassMenuStyles)},{default:p(()=>[u(tt,{class:"text-center"},{default:p(()=>t[7]||(t[7]=[H("Map widget settings")])),_:1,__:[7]}),u(at,null,{default:p(()=>[u(qt,{modelValue:n(E).options.showVehiclePath,"onUpdate:modelValue":t[4]||(t[4]=l=>n(E).options.showVehiclePath=l),class:"my-1",label:"Show vehicle path",color:n(E).options.showVehiclePath?"white":void 0,"hide-details":""},null,8,["modelValue","color"])]),_:1})]),_:1},8,["style"])]),_:1},8,["modelValue"]),ue.value?(w(),N(Jt,{key:0,"model-value":Pe.value,height:"10",absolute:"",bottom:"",color:"white",style:le(`top: ${He.value}`)},null,8,["model-value","style"])):z("",!0),ue.value?(w(),W("p",{key:1,style:le({top:He.value}),class:"absolute left-[7px] mt-4 flex text-md font-bold text-white z-30 drop-shadow-md"}," Loading mission... ",4)):z("",!0),u(Qt,{ref_key:"poiManagerMapWidgetRef",ref:G},null,512),u(la,{"model-value":o.value,onConfirmed:De,"onUpdate:modelValue":t[6]||(t[6]=l=>o.value=l)},null,8,["model-value"]),d.value?(w(),W("div",{key:2,class:"absolute top-14 left-2 flex justify-start items-center text-white text-md py-2 px-4 rounded-lg",style:le(n(C).globalGlassMenuStyles)},[U("p",null,"Saving offline map content: "+it(P.value?Math.round(x.value/P.value*100):0)+"%",1)],4)):z("",!0)],64)}}}),ca=st(na,[["__scopeId","data-v-44ea2cd1"]]);export{ca as default};
