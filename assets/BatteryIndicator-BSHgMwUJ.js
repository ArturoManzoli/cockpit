import{c as z,J as G,K as R,u as q,y as E,L as H,r as u,k as c,w as B,M as J,N as K,h as L,l as V,m as y,G as Q,T as X,n as l,v as P,t as x,F as S,H as n,O as g,V as Y,P as Z,q as a,Q as ee,R as U,S as te,U as W,W as F,X as le,Y as ae,Z as oe}from"./index-B-cmhIsN.js";const se={class:"flex items-center w-[5.5rem] h-12 text-white justify-center"},ne={class:"flex flex-col w-[4rem] select-none text-sm font-semibold leading-4 text-end"},ue={class:"w-full items-center"},re={class:"font-mono"},ie={class:"w-full"},de={class:"font-mono"},pe={class:"font-mono"},ve={class:"text-red-500 text-center text-sm w-[full]"},me={class:"flex items-center"},ge={class:"flex w-full justify-end my-0"},p=500,ce=z({__name:"BatteryIndicator",props:{miniWidget:{}},setup(k){const{showDialog:O}=G(),t=R(k).miniWidget,M={showCurrent:!0,showPower:!0,toggleInterval:1e3},o=q(),b=E(),j=H(),f=u(!0),v=u(void 0),w=u(""),h=u(void 0),i=u(t.value.options.toggleInterval??M.toggleInterval),m=u(t.value.options.warningVoltage!==void 0),C=u(t.value.options.warningVoltage??0),d=u(null),I=u(!1),T=u(!1),N=c(()=>{var r;return((r=o==null?void 0:o.powerSupply)==null?void 0:r.voltage)===void 0?NaN:Math.abs(o.powerSupply.voltage)>=100?o.powerSupply.voltage.toFixed(0):o.powerSupply.voltage.toFixed(1)}),A=c(()=>{var r;return((r=o==null?void 0:o.powerSupply)==null?void 0:r.current)===void 0?NaN:Math.abs(o.powerSupply.current)>=100?o.powerSupply.current.toFixed(0):o.powerSupply.current.toFixed(1)}),_=c(()=>o.instantaneousWatts!==void 0?o.instantaneousWatts.toFixed(1):NaN),$=c(()=>"mdi-battery"),D=()=>{(v.value||h.value)&&(clearInterval(v.value),clearTimeout(h.value)),i.value<p?(t.value.options.toggleInterval=p,w.value=`Interval must be at least ${p}ms.`):t.value.options.toggleInterval=i.value,!t.value.options.showCurrent&&!t.value.options.showPower&&(t.value.options.showCurrent=!0,t.value.options.showPower=!0,w.value="At least one of the options must be enabled."),t.value.options.showCurrent&&t.value.options.showPower?v.value=setInterval(()=>{f.value=!f.value},t.value.options.toggleInterval):f.value=t.value.options.showCurrent,h.value=setTimeout(()=>{w.value="",i.value<p&&(i.value=p)},5e3)};return B([()=>t.value.options,i],D,{deep:!0}),B(()=>N.value,r=>{const e=Number(r);m.value&&C.value&&e<C.value&&!T.value?!d.value&&!I.value&&(d.value=setTimeout(()=>{I.value=!0,O({title:"Battery Warning",message:`Voltage is below ${C.value}V!`,variant:"error"}).finally(()=>{I.value=!1,T.value=!0}),d.value=null},5e3)):d.value&&(clearTimeout(d.value),d.value=null)}),J(()=>{t.value.options=Object.assign({},M,t.value.options),D(),K.registerUsage("Instantaneous Watts")}),L(()=>{v.value===void 0&&clearInterval(v.value)}),(r,e)=>(V(),y(S,null,[Q((V(),y("div",se,[l("span",{class:P(["relative w-[1.5rem] mdi battery-icon",[$.value]])},e[7]||(e[7]=[l("span",{class:"absolute text-sm text-yellow-400 -bottom-[2px] -right-[7px] mdi mdi-alert-circle"},null,-1)]),2),l("div",ne,[l("div",ue,[l("span",re,x(N.value),1),e[8]||(e[8]=l("span",null," V",-1))]),l("div",ie,[f.value?(V(),y(S,{key:0},[l("span",de,x(A.value),1),e[9]||(e[9]=l("span",null," A",-1))],64)):(V(),y(S,{key:1},[l("span",pe,x(_.value),1),e[10]||(e[10]=l("span",null," W",-1))],64))])])])),[[X,"Battery information"]]),n(oe,{modelValue:a(b).miniWidgetManagerVars(a(t).hash).configMenuOpen,"onUpdate:modelValue":e[6]||(e[6]=s=>a(b).miniWidgetManagerVars(a(t).hash).configMenuOpen=s),width:"auto"},{default:g(()=>[n(Y,{class:"pa-4 pb-3 text-white w-[20rem]",style:Z([{"border-radius":"15px"},a(j).globalGlassMenuStyles])},{default:g(()=>[n(ee,{class:"text-center"},{default:g(()=>e[11]||(e[11]=[U("Battery Indicator Config")])),_:1}),n(te,{class:"flex flex-col gap-y-2"},{default:g(()=>[n(W,{modelValue:a(t).options.showCurrent,"onUpdate:modelValue":e[0]||(e[0]=s=>a(t).options.showCurrent=s),label:"Show Current","hide-details":""},null,8,["modelValue"]),n(W,{modelValue:a(t).options.showPower,"onUpdate:modelValue":e[1]||(e[1]=s=>a(t).options.showPower=s),label:"Show Power","hide-details":"",class:"mt-[-15px]"},null,8,["modelValue"]),n(F,{modelValue:i.value,"onUpdate:modelValue":e[2]||(e[2]=s=>i.value=s),modelModifiers:{number:!0},label:"Toggle Interval (ms)",type:"number",min:p,step:"100",density:"compact",variant:"outlined",disabled:!a(t).options.showCurrent||!a(t).options.showPower},null,8,["modelValue","disabled"]),l("p",ve,x(w.value),1),n(W,{modelValue:m.value,"onUpdate:modelValue":e[3]||(e[3]=s=>m.value=s),"hide-details":"",label:"Warn if battery voltage drops under:"},null,8,["modelValue"]),l("div",me,[n(F,{modelValue:a(t).options.warningVoltage,"onUpdate:modelValue":e[4]||(e[4]=s=>a(t).options.warningVoltage=s),variant:"outlined","hide-details":"",density:"compact",type:"number",step:"0.1",width:"30px",disabled:!m.value,class:P({"opacity-50":!m.value})},null,8,["modelValue","disabled","class"]),e[12]||(e[12]=l("p",{class:"w-8 text-center"},"V",-1))])]),_:1}),n(le,{class:"w-4/5 self-center mb-2"}),l("div",ge,[n(ae,{variant:"text",onClick:e[5]||(e[5]=s=>a(b).miniWidgetManagerVars(a(t).hash).configMenuOpen=!1)},{default:g(()=>e[13]||(e[13]=[U("Close")])),_:1})])]),_:1},8,["style"])]),_:1},8,["modelValue"])],64))}});export{ce as default};
