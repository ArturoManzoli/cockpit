import{c as ce,z as we,K as he,aL as be,J as xe,r as f,k as B,aB as ye,w as ke,L as Ve,o as Me,l as d,m,n as u,H as o,N as r,Q as V,ae as J,q as N,ar as Q,aM as Ce,O as z,t as Y,s as a,v as M,I as R,a5 as T,a2 as Fe,aN as We,aO as j,aP as H,aQ as Be,aR as Se,x as c,F as S,p as E,aS as Z,aT as ee,V as Le,P as ze,U as te,az as ae,aU as Ee,al as Oe,aH as Ie,aV as Ue,_ as Ae}from"./index-B5GXSSUo.js";const $e=["width","height"],De={class:"flex flex-col justify-between h-full pa-2 cursor-pointer"},Ne={class:"flex justify-between w-full"},Re={key:0},Te={key:0},je={class:"flex"},He={key:0,class:"flex rotate-[270deg] justify-center whitespace-nowrap"},_e={class:"flex justify-center h-full px-3 pt-2 gap-x-2"},Xe=["data-widget-hash"],Ge=["data-widget-hash"],Ke={class:"flex flex-col justify-start items-start gap-x-4 mt-3 w-full"},Pe=ce({__name:"CustomWidgetBase",props:{widget:{}},setup(le){const n=we(),se=he(),{showSnackbar:O}=be(),w=le,i=xe(w).widget,g=f(w.widget),I=f(new Map),_=f(!1),X=f("justify-center"),ne=f(!1),U=f(!1),C=f(w.widget.name),x=f(null),L=f(w.widget.options.leftColumnWidth||50),G=f(!1),F=f(null),p=f(!1),y=f("right"),A=()=>{if(F.value){const l=F.value.getBoundingClientRect(),e=window.innerWidth;l.left+l.width/2<e/2?y.value="left":y.value="right"}},oe=B(()=>y.value==="left"?p.value?"mdi-chevron-right":"mdi-chevron-left":p.value?"mdi-chevron-left":"mdi-chevron-right"),ie=()=>{C.value=w.widget.name,U.value=!0,Ie(()=>{x.value&&(x.value.focus(),x.value.select())})},K=()=>{U.value=!1,g.value&&C.value!==g.value.name&&(g.value.name=C.value)},de=l=>{var s;const e=(s=l.target.files)==null?void 0:s[0];if(!e){O({variant:"error",message:"No file selected.",duration:3e3});return}const t=new FileReader;t.onload=k=>{var b;try{const v=JSON.parse((b=k.target)==null?void 0:b.result),W=g.value.hash;n.loadWidgetFromFile(W,v)}catch{O({variant:"error",message:"Invalid widget file format.",duration:3e3})}},t.readAsText(e)},$=l=>{if(ne.value=!1,l==="options")n.widgetManagerVars(g.value.hash).configMenuOpen=!0;else if(l==="save")n.downloadWidgetAsBrw(g.value);else if(l==="load"){const e=document.createElement("input");e.type="file",e.accept=".brw",e.addEventListener("change",t=>{de(t)}),e.click()}},re=l=>{if(!n.editingMode)return;const e=l.clientX,t=L.value;G.value=!0;const s=b=>{if(!F.value)return;const v=F.value.offsetWidth,W=t+(b.clientX-e)/v*100;L.value=Math.max(10,Math.min(90,W))},k=()=>{G.value=!1,document.removeEventListener("mousemove",s),document.removeEventListener("mouseup",k)};document.addEventListener("mousemove",s),document.addEventListener("mouseup",k)},ue=B(()=>g.value.options.elementContainers.filter(l=>l.name.includes("left"))),me=B(()=>g.value.options.elementContainers.filter(l=>l.name.includes("right"))),ge=B(()=>Math.round(i.value.options.backgroundOpacity*255).toString(16)),ve=()=>{n.allowMovingAndResizing(g.value.hash,!0),window.addEventListener("mouseup",h),window.addEventListener("dragend",h)},h=()=>{A(),n.allowMovingAndResizing(g.value.hash,!1),window.removeEventListener("mouseup",h),window.removeEventListener("dragend",h)},P=(l,e)=>{const t=g.value.options.elementContainers.find(v=>v.name===e);if(!t)return;const s=t.elements.map(v=>v.hash),k=I.value.get(e)||[],b=s.find(v=>!k.includes(v));if(b){const v=t.elements.find(W=>W.hash===b);v&&l.pullMode==="clone"&&(v.hash=Ue(),n.miniWidgetManagerVars(v.hash).configMenuOpen=!0),I.value.set(e,s)}},{width:q}=ye(),D=B(()=>({width:g.value.size.width*q.value,height:g.value.size.height*q.value})),fe=f(null);ke(()=>n.editingMode,l=>{l===!0&&(h(),p.value=!1)});const pe=()=>{try{const l=n.editWidgetByHash(w.widget.hash);l&&(g.value=l)}catch{O({variant:"warning",message:"Error reading widget file.",duration:1e3})}};return Ve(()=>{w.widget.options.elementContainers.forEach(l=>{I.value.set(l.name,l.elements.map(e=>e.hash))})}),Me(()=>{A(),window.addEventListener("resize",A),fe.value=document.querySelector(".main"),pe(),h()}),(l,e)=>(d(),m(S,null,[u("div",{ref_key:"widgetBase",ref:F,class:c(["h-full rounded-lg overflow-hidden",[p.value?"w-[40px]":"w-full",p.value&&y.value==="left"?"ml-0 mr-auto":"",p.value&&y.value==="right"?"mr-0 ml-auto":""]]),width:D.value.width,height:D.value.height,style:z([a(se).globalGlassMenuStyles,{backgroundColor:`${a(i).options.backgroundColor+ge.value}`,backdropFilter:`blur(${a(i).options.backgroundBlur}px)`}])},[u("div",De,[u("div",Ne,[o(J,{class:"cursor-grab opacity-40",onMousedown:ve,onMouseup:h},{default:r(()=>e[11]||(e[11]=[V(" mdi-drag ")])),_:1}),p.value?M("",!0):(d(),m("div",Re,[U.value?(d(),m("div",Te,[N(u("input",{ref_key:"nameInput",ref:x,"onUpdate:modelValue":e[0]||(e[0]=t=>C.value=t),class:"border-b border-gray-400",onBlur:K,onKeyup:Ce(K,["enter"])},null,544),[[Q,C.value]])])):(d(),m("p",{key:1,class:"whitespace-nowrap overflow-hidden text-ellipsis",style:z({maxWidth:`${D.value.width*.8}px`}),onDblclick:ie},Y(a(i).name),37))])),u("div",je,[a(n).editingMode?(d(),R(Be,{key:0,theme:"dark"},{activator:r(({props:t})=>[o(T,Fe({size:"20",icon:"mdi-dots-vertical",variant:"text"},t),null,16)]),default:r(()=>[o(We,null,{default:r(()=>[o(j,{onClick:e[1]||(e[1]=t=>$("options"))},{default:r(()=>[o(H,null,{default:r(()=>e[12]||(e[12]=[V("Options")])),_:1})]),_:1}),o(j,{onClick:e[2]||(e[2]=t=>$("save"))},{default:r(()=>[o(H,null,{default:r(()=>e[13]||(e[13]=[V("Save")])),_:1})]),_:1}),o(j,{onClick:e[3]||(e[3]=t=>$("load"))},{default:r(()=>[o(H,null,{default:r(()=>e[14]||(e[14]=[V("Load")])),_:1})]),_:1})]),_:1})]),_:1})):M("",!0)])]),p.value?(d(),m("div",He,Y(a(i).name),1)):M("",!0),N(u("div",_e,[u("div",{class:c(["flex flex-col justify-center border-[#FFFFFF33] border-dashed rounded-md",[a(n).editingMode?"border-[1px]":"border-0"]]),style:z({width:a(i).options.columns>1?`${L.value}%`:"100%"})},[(d(!0),m(S,null,E(ue.value,t=>(d(),m("div",{key:t.name,class:"w-full h-full"},[o(a(ee),{modelValue:t.elements,"onUpdate:modelValue":s=>t.elements=s,disabled:!a(n).editingMode,animation:150,group:"generalGroup",class:c(["flex items-center w-full h-full gap-2 px-2",[_.value?"flex-wrap":"",X.value]]),onAdd:s=>P(s,t.name)},{default:r(()=>[(d(!0),m(S,null,E(t.elements,s=>(d(),m("div",{key:s.hash,"data-widget-hash":s.hash,class:c(["rounded-md w-full",{"cursor-grab":a(n).editingMode,"bg-slate-400":a(n).miniWidgetManagerVars(s.hash).highlighted}])},[o(Z,{"mini-widget":s},null,8,["mini-widget"])],10,Xe))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","disabled","class","onAdd"])]))),128))],6),a(i).options.columns>1&&a(n).editingMode?(d(),m("div",{key:0,class:"cursor-col-resize w-1 bg-[#FFFFFF22] relative",onMousedown:re},e[15]||(e[15]=[u("div",{class:"absolute inset-y-0 -left-1 -right-1"},null,-1)]),32)):M("",!0),a(i).options.columns>1?(d(),m("div",{key:1,class:c(["flex flex-col justify-center border-[#FFFFFF33] border-dashed rounded-md",[a(n).editingMode?"border-[1px]":"border-0"]]),style:z({width:`${100-L.value}%`})},[(d(!0),m(S,null,E(me.value,t=>(d(),m("div",{key:t.name,class:"w-full h-full"},[o(a(ee),{modelValue:t.elements,"onUpdate:modelValue":s=>t.elements=s,disabled:!a(n).editingMode,animation:150,group:"generalGroup",class:c(["flex items-center w-full h-full gap-2 px-2",[_.value?"flex-wrap":"",X.value]]),onAdd:s=>P(s,t.name)},{default:r(()=>[(d(!0),m(S,null,E(t.elements,s=>(d(),m("div",{key:s.hash,"data-widget-hash":s.hash,class:c(["rounded-md w-full",{"cursor-grab":a(n).editingMode,"bg-slate-400":a(n).miniWidgetManagerVars(s.hash).highlighted}])},[o(Z,{"mini-widget":s},null,8,["mini-widget"])],10,Ge))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","disabled","class","onAdd"])]))),128))],6)):M("",!0)],512),[[Se,!p.value]]),e[16]||(e[16]=u("div",null,null,-1)),a(n).editingMode?M("",!0):(d(),R(T,{key:1,class:c(["fixed bottom-[2px]",y.value==="left"?"left-[2px]":"right-[2px]"]),icon:oe.value,variant:"text",size:"36",onClick:e[4]||(e[4]=t=>p.value=!p.value)},null,8,["class","icon"]))])],14,$e),(d(),R(Oe,{to:"body"},[o(Ee,{"is-visible":a(n).widgetManagerVars(a(i).hash).configMenuOpen},{default:r(()=>[o(Le,{class:"px-8 pb-6 pt-2 rounded-lg w-[400px] bg-transparent"},{default:r(()=>[o(ze,{class:"text-center -mt-1"},{default:r(()=>e[17]||(e[17]=[V("Custom Widget options")])),_:1}),o(T,{class:"absolute top-3 right-0 text-lg rounded-full",variant:"text",size:"small",onClick:e[5]||(e[5]=t=>a(n).widgetManagerVars(a(i).hash).configMenuOpen=!1)},{default:r(()=>[o(J,null,{default:r(()=>e[18]||(e[18]=[V("mdi-close")])),_:1})]),_:1}),u("div",Ke,[e[19]||(e[19]=u("p",{class:"text-start"},"Name:",-1)),o(te,{ref_key:"nameInput",ref:x,modelValue:a(i).name,"onUpdate:modelValue":e[6]||(e[6]=t=>a(i).name=t),density:"compact",class:"w-3/4"},null,8,["modelValue"]),e[20]||(e[20]=u("p",{class:"text-start"},"Columns:",-1)),o(te,{ref_key:"nameInput",ref:x,modelValue:a(i).options.columns,"onUpdate:modelValue":e[7]||(e[7]=t=>a(i).options.columns=t),min:"1",max:"2",type:"number",density:"compact",class:"w-1/4"},null,8,["modelValue"]),e[21]||(e[21]=u("p",{class:"mt-1"},"Background color",-1)),N(u("input",{"onUpdate:modelValue":e[8]||(e[8]=t=>a(i).options.backgroundColor=t),type:"color",class:"p-0 w-20 mr-4"},null,512),[[Q,a(i).options.backgroundColor]]),e[22]||(e[22]=u("p",{class:"mt-3"},"Background opacity:",-1)),o(ae,{modelValue:a(i).options.backgroundOpacity,"onUpdate:modelValue":e[9]||(e[9]=t=>a(i).options.backgroundOpacity=t),min:"0",max:"1",color:"white","thumb-label":"",width:"250"},null,8,["modelValue"]),e[23]||(e[23]=u("p",{class:"mt-3"},"Background blur:",-1)),o(ae,{modelValue:a(i).options.backgroundBlur,"onUpdate:modelValue":e[10]||(e[10]=t=>a(i).options.backgroundBlur=t),min:"0",max:"100",color:"white","thumb-label":"",width:"250"},null,8,["modelValue"])])]),_:1})]),_:1},8,["is-visible"])]))],64))}}),Je=Ae(Pe,[["__scopeId","data-v-21dd113d"]]);export{Je as default};
